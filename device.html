<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<!--<link rel="stylesheet" href="css/bootstrap.min.css" />-->
	<link rel="stylesheet" href="css/electricroommonitoring.css"/>
	<title>告警信息</title>
	<script  type="text/javascript" src="js/config.js"></script>
	<script  type="text/javascript" src="js/jquery-3.3.1.js"></script>
	<script  type="text/javascript" src="js/layer/layer.js"></script>
	<script type="text/javascript" src="js/jquery.table2excel.min.js"></script>
	<!--<script  type="text/javascript" src="js/radialIndicator.js"></script>
	<script  type="text/javascript" src="js/jquery.tablesort.min.js"></script>
	<script language="javascript" type="text/javascript" src="My97DatePicker/WdatePicker.js"></script>-->
	<script  type="text/javascript" src="js/function.js"></script>
	<style>
	*{
       margin:0px;
       padding:0px;
    }
    /**/
    th,td{
        border:1px solid black;
        text-align:center;
        line-height:center;
        width:160px;
        height:30px;
    }
	table {
		/*设置相邻单元格的边框间的距离*/
		border-spacing: 0;
		/*表格设置合并边框模型*/
		border-collapse: collapse;
		text-align: center;
	}
	/*关键设置 tbody出现滚动条height: 450px;overflow-y: scroll;*/
	table tbody {
		display: block;
	}
	table thead,
	tbody tr {
		display: table;
		table-layout: fixed;
	}
	/*关键设置：滚动条默认宽度是16px 将thead的宽度减16pxwidth: 100%;
	table thead {
		width: calc( tbody.width )
	}
	table thead th {
		background: #ccc;
	}*/
	span{
		margin-left:10px;
	}
	</style>
</head>
<body >
	<div><button class="selected" onclick="javascript:history.go(-1)" style="float:right;margin-right:20px;">返回</button>
		<div class="pagecard" id="pagecard1" style="margin-bottom:10px">
			<h3 >设备信息</h3>
        </div>
        <div  class="rowlay" style="display: none;" >
            <ul class="count_info" text-align="center" >
                <!--<li style="width:50px"><b>站名：</b></li>
                <li id="station_name"style="width:100px;margin-right:0px"> </li>-->
                <li style="width:50px;margin-right:0px"><b>记录数：</b></li>
                <li id="count_val"style="width:50px;margin-right:0px"> </li>
				<li style="width:100px;margin-right:0px"><a href="javascript:void(0)" style="margin-left:20px;" onclick="exporttoexcel('devicetable')">
					<img src="res/dcexcel.jpg" alt="Big Boat" title="导出到Excel" class="img-thumbnail img-responsive" style="width:40px;"></a>
				</li>
            </ul>
        </div>
		<div style="text-align: center;">
            <div  style="text-align: center;font-size: 18px;display: none;">
                <a id="btn0"></a>
                <input id="pageSize" type="text" size="1" maxlength="3" value="" style="text-align: center;"/><a> 条 </a> <a href="javascript:void(0)" id="pageSizeSet" onclick="setPageSize()">设置</a>&nbsp;
                <a id="sjzl"></a>&nbsp;
                <a  href="javascript:void(0)" id="btn1" onclick="firstPage()">首页</a>
                <a  href="javascript:void(0)" id="btn2" onclick="frontPage()">上一页</a>
                <a  href="javascript:void(0)" id="btn3" onclick="nextPage()">下一页</a>
                <a  href="javascript:void(0)" id="btn4" onclick="lastPage()">尾页</a>&nbsp;
                <a>转到&nbsp;</a>
                <input id="changePage" type="text" size="1" maxlength="4"/>
                <a>页&nbsp;</a>
                <a  href="javascript:void(0)" id="btn5" onclick="changePage()">跳转</a>
				<a href="javascript:void(0)" style="margin-left:20px;" onclick="exporttoexcel('devicetable')"><!--method5('devicetable')-->
					<img src="res/gif_export.gif" alt="Big Boat" title="导出到Excel"></a>
            </div>
		<table id="devicetable" style="margin: auto;">
			<caption style="text-align: center;font-size:20px;">设备信息汇总表</caption>
			<tr >
				<th onclick="$.sortTable.sort('devicetable',0)">设备编号</th>
				<th onclick="$.sortTable.sort('devicetable',1)">设备名称</th>
				<th onclick="$.sortTable.sort('devicetable',2)">安装时间</th>
				<th onclick="$.sortTable.sort('devicetable',3)">地址</th>
				<th onclick="$.sortTable.sort('devicetable',4)">类型</th>
				<th onclick="$.sortTable.sort('devicetable',5)">分组</th>
				<th onclick="$.sortTable.sort('devicetable',6)">序列号</th>	
			<!--<th style="width:18px;border:0px solid black;"></th>-->
			</tr>
			<tbody id='device-tbody' style="width:1140px;height:550px; overflow:auto;">
			</tbody>
		</table>
	</div>
	<div id="indicatorContainer"></div>
    </div>
    <script>
        var pageSize = 18;    //每页显示的记录条数
        var curPage=0;        //当前页
        //var lastpage;        //最后页
        var direct=0;        //方向
        var len;            //总行数
        var page;            //总页数
        var begin;
        var end;
        var count;
        var tbody;
		initdevice();
		/*$(function() {
			$('table').tablesort().data('tablesort');
		});*/
        function initdevice(){
			updatapcnav(9);
			sessionStorage.framepage="device.html";
			var parentid=-100,parentname="";
			tbody=document.getElementById("device-tbody");
			deleterows(tbody);
            sensors=JSON.parse(localStorage.getItem("sensors"));
			if(sensors!=null){
				for(var i=0;i<sensors.length;i++){
					var tr=document.createElement("tr");
					tr.setAttribute("onclick","tableclick(this)");
                    //if (i % 2 == 0) {
					//	tr.setAttribute('style', "background-color:#16b9c9");
					//}
                    var td_did=document.createElement("td");
					td_did.innerHTML=sensors[i].id;
					if((sensors[i].Value.parentId!="-1")&&(sensors[i].Value.parentId!=parentid)){
						parentid=sensors[i].Value.parentId;
						for(var j=0;j<sensors.length;j++){
							if(sensors[j].id==parentid){
								parentname=sensors[j].Value.name+"_";
								break;
							}
						}
					}
                    var td_dname=document.createElement("td");
                    td_dname.innerHTML=parentname+sensors[i].Value.name;
                    var td_dtime=document.createElement("td");
                    td_dtime.innerHTML=sensors[i].Value.time;
                    var td_dadr=document.createElement("td");
                    td_dadr.innerHTML=sensors[i].Value.address;
                    var td_dtype=document.createElement("td");
					td_dtype.innerHTML=getname(sensors[i].Value.type);
					var td_group=document.createElement("td");
					td_group.innerHTML='';//sensors[i].Value.Group;
					var td_serial= document.createElement("td");
					td_serial.innerHTML=sensors[i].Value.serial;
                    tr.appendChild(td_did);
                    tr.appendChild(td_dname);
                    tr.appendChild(td_dtime);
                    tr.appendChild(td_dadr);
					tr.appendChild(td_dtype);
					tr.appendChild(td_group);
					tr.appendChild(td_serial);
                    tbody.appendChild(tr);
				}
				document.getElementById("count_val").innerHTML=sensors.length;
            }
            //display();//分页显示功能。 
        }
		function deleterows(atable){//清除原因表内数据
			for(var i=atable.rows.length;i>0;i--){
				atable.removeChild(atable.rows[i-1]);
			}
		}
		function tableclick(tr){
			$(tr).siblings().css("background","");
			$(tr).css("background","#85e494");//区分选中行
		}
        function display(){   
			//var tbody=$("#device-tbody");
			len =tbody.rows.length ;//- 1;    // 求这个表的总行数，剔除第一行介绍
			page=len % pageSize==0 ? len/pageSize : Math.floor(len/pageSize)+1;//根据记录条数，计算页数
			// alert("page==="+page);
			curPage=1;    // 设置当前为第一页
			displayPage(1);//显示第一页
			document.getElementById("btn0").innerHTML="当前 " + curPage + "/" + page + " 页    每页 ";    // 显示当前多少页
			document.getElementById("sjzl").innerHTML="数据总量 <span class='badge' style='font-size:18px'>" + len + "";        // 显示数据量
			document.getElementById("pageSize").value = pageSize;
		}
		function firstPage(){    // 首页
			curPage=1;
			direct = 0;
			displayPage();
		}
		function frontPage(){    // 上一页
			direct=-1;
			displayPage();
		}
		function nextPage(){    // 下一页
			direct=1;
			displayPage();
		}
		function lastPage(){    // 尾页
			curPage=page;
			direct = 0;
			displayPage();
		}
		function changePage(){    // 转页
			curPage=document.getElementById("changePage").value * 1;
			if (!/^[1-9]\d*$/.test(curPage)) {
				layer.alert("请输入正整数");
				return ;
			}
			if (curPage > page) {
				layer.alert("超出数据页面");
				return ;
			}
			direct = 0;
			displayPage();
		}
		function setPageSize(){    // 设置每页显示多少条记录
			pageSize = document.getElementById("pageSize").value;    //每页显示的记录条数
			if (!/^[1-9]\d*$/.test(pageSize)) {
				layer.alert("请输入正整数");
				return ;
			}
			len =tbody.rows.length - 1;
			page=len % pageSize==0 ? len/pageSize : Math.floor(len/pageSize)+1;//根据记录条数，计算页数
			curPage=1;        //当前页
				direct=0;        //方向
				firstPage();
		}
	function displayPage(){
		if(curPage <=1 && direct==-1){
			direct=0;
			layer.alert("已经是第一页了");
			return;
		} else if (curPage >= page && direct==1) {
			direct=0;
			layer.alert("已经是最后一页了");
			return ;
		}
		//lastPage = curPage;
		// 修复当len=1时，curPage计算得0的bug
		if (len > pageSize) {
			curPage = ((curPage + direct + len) % len);
		} else {
			curPage = 1;
		}
		document.getElementById("btn0").innerHTML="当前 " + curPage + "/" + page + " 页    每页 ";        // 显示当前多少页
		begin=(curPage-1)*pageSize ;// 起始记录号
		end = begin + 1*pageSize ;    // 末尾记录号
		if(end > len ) end=len;
		//var theTable=$("#warnlogdata-tbody");// document.getElementById("warnlogdata-tbody");
		for ( var i = 0; i<len; i++ ) {
			tbody.rows[i].style.display = 'none';
		}
		for ( var i = begin; i<end; i++ ) {
			tbody.rows[i].style.display = '';
		}
		/*$table.find("tr").hide();    // 首先，设置这行为隐藏
		$table.find("tr").each(function(i){    // 然后，通过条件判断决定本行是否恢复显示
			if((i>=begin && i<=end) )//显示begin<=x<=end的记录
				$(this).show();
		});*/
	}
    </script>
</body>