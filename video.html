<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8"> 
   <title>在线尝试 Bootstrap 实例</title>
   <link rel="stylesheet" href="css/bootstrap.min.css" /> 
   <link rel="stylesheet" href="css/preview.css" /> 
   <script  type="text/javascript" src="js/jquery-3.3.1.js"></script>
   <script src="js/bootstrap.js"></script>
   <script type="text/javascript" src="js/config.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/flv.js/dist/flv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dashjs/dist/dash.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/webtorrent/latest/webtorrent.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pearplayer"></script>
    <script type="text/javascript" src="js/layer/layer.js"></script>
   <script src="js/DPlayer.min.js"></script>
</head>
<style>
</style>

<body >
    <!--h1-- class="btn btn-success btn-large"><i class="glyphicon glyphicon-user"></i>Hello, world!<li><a href="#tab3" data-toggle="tab">Html</a></li>
        <li><a href="#tab4" data-toggle="tab">javascript</a></li></!--h1-->
    <ul class="nav nav-tabs">
        <li class="active"><a href="#tab1" data-toggle="tab">预览</a></li>
        <li><a href="#tab2" data-toggle="tab">回放</a></li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane active" id="tab1">
            <div class="left" >
                <fieldset class="clist" >
                    <legend>设备列表</legend>
                    <form class="opinfo" id="sz_list"></form>
                </fieldset>
            </div>
            <div class="left">
                <div id="dplayer" style="width:600px;height:500px;margin:30px;background-color: gray;">
                </div>
            </div>
            <div class="left">
                <fieldset class="preview">
                    <legend>预览</legend>
                    <table cellpadding="0" cellspacing="3" border="0">
                        <tr>
                            <td class="tt">码流类型</td>
                            <td>
                                <select id="streamtype" class="sel">
                                    <option value="0">主码流</option>
                                    <option value="1">子码流</option>
                                    <!--<option value="3">第三码流</option>
                                    <option value="4">转码码流</option>-->
                                </select>
                            </td>
                            <td>
                                <input type="button" class="btn" value="开始预览" onclick="clickStartRealPlay();" />
                                <input type="button" class="btn" value="停止预览" onclick="clickStopRealPlay();" />
                            </td>
                        </tr>
                        
                        <!--<tr>
                            <td colspan="3">
                                <input type="button" class="btn" value="抓图" onclick="clickCapturePic();" />
                                <input type="button" class="btn" value="开始录像" onclick="clickStartRecord();" />
                                <input type="button" class="btn" value="停止录像" onclick="clickStopRecord();" />
                            </td>
                        </tr>
                        tr>
                            <td colspan="3">
                                <input type="button" class="btn2" value="启用电子放大" onclick="clickEnableEZoom();" />
                                <input type="button" class="btn2" value="禁用电子放大" onclick="clickDisableEZoom();" />
                                <input type="button" class="btn2" value="启用3D放大" onclick="clickEnable3DZoom();" />
                                <input type="button" class="btn2" value="禁用3D放大" onclick="clickDisable3DZoom();" />
                                <input type="button" class="btn" value="全屏" onclick="clickFullScreen();" />
                            </td>
                        </tr-->
                    </table>
                </fieldset>
                <fieldset class="playback" >
                    <legend>回放</legend>
                    <table width="100%" cellpadding="0" cellspacing="3" style="border:0">
                        <tr>
                            <td class="tt">开始时间</td>
                            <td>
                                <input id="starttime" type="text" class="txt" value="2013-12-10 00:00:00" />（时间格式：2013-11-11 12:34:56）
                            </td>
                        </tr>
                        <tr>
                            <td class="tt">结束时间</td>
                            <td>
                                <input id="endtime" type="text" class="txt" value="2013-12-11 23:59:59" />
                                <input type="button" class="btn" value="搜索" onclick="clickRecordSearch(0);" />
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <div class="searchdiv">
                                    <table id="searchlist" class="searchlist" cellpadding="0" cellspacing="0" style="border:0"></table>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <input type="button" class="btn2" value="开始回放" onclick="clickStartPlayback();" />
                                <input type="button" class="btn2" value="停止回放" onclick="clickStopPlayback();" />
                                <!--input type="button" class="btn" value="倒放" onclick="clickReversePlayback();" /-->
                                <input type="button" class="btn" value="单帧" onclick="clickFrame();" />
                                <input id="transstream" type="checkbox" class="vtop" />&nbsp;启用转码码流
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <input type="button" class="btn" value="暂停" onclick="clickPause();" />
                                <input type="button" class="btn" value="恢复" onclick="clickResume();" />
                                <input type="button" class="btn" value="慢放" onclick="clickPlaySlow();" />
                                <input type="button" class="btn" value="快放" onclick="clickPlayFast();" />
                            </td>
                        </tr>
                        <!--<tr>
                            <td colspan="2">
                                <input type="button" class="btn" value="抓图" onclick="clickCapturePic();" />
                                <input type="button" class="btn2" value="开始剪辑" onclick="clickStartRecord();" />
                                <input type="button" class="btn2" value="停止剪辑" onclick="clickStopRecord();" />
                                <input type="button" class="btn2" value="OSD时间" onclick="clickGetOSDTime();" />&nbsp;<input id="osdtime" type="text" class="txt" readonly />
                            </td>
                        </tr>-->
                    </table>
                </fieldset>
                <!--<fieldset class="operate">
                    <legend>操作信息</legend>
                    <div id="opinfo" class="opinfo"></div>
                </fieldset>
                <fieldset class="callback">
                    <legend>事件回调信息</legend>
                    <div id="cbinfo" class="cbinfo"></div>
                </fieldset>-->
            </div>
        </div>
        <div class="tab-pane " id="tab2"><img src="res/lock.png"></img></div>
        <!--div class="tab-pane" id="tab3"><img src="res/on.png"></img></!--div>
        <div-- class="tab-pane" id="tab4">
            <img src="res/t1.jpg"></img>
        </div-->
    </div>
    <script>
        var sel_id,dp;
        $(function(){
            $(".tab a:last").tab("show");
        })
        initpage();
        function initpage(){
			var parentid = -100, parentname = "";
			var maps = [];
            var sel_sensor = document.getElementById("sz_list");
			for (var i = sel_sensor.length-1; i >= 0; i--) {
				sel_sensor.removeChild(sel_sensor.children[i]);
			}
			var sensors = JSON.parse(localStorage.getItem("sensors"));
			if (sensors != null) {
				for (var i = 0; i < sensors.length; i++) {
                    if(sensors[i].Value.ParentId=="-1")
                        continue;
                    if ((sensors[i].Value.ParentId != "-1") && (sensors[i].Value.ParentId != parentid)) {
						parentid = sensors[i].Value.ParentId;
						for (var j = 0; j < sensors.length; j++) {
							if (sensors[j].id == parentid) {
								parentname = sensors[j].Value.Name + "_";
								break;
							}
						}
					}
					var map = new Object();
					map.value = sensors[i].id;
					map.name = parentname + sensors[i].Value.Name;
					maps.push(map);
				}
				var compare = function (obj1, obj2) {
					var val1 = obj1.name;
					var val2 = obj2.name;
					if (val1 < val2) {
						return -1;
					} else if (val1 > val2) {
						return 1;
					} else {
						return 0;
					}
				}
				maps.sort(compare);
				for (var k = 0; k < maps.length; k++) {
					var p = document.createElement("p");
					var lab=document.createElement("label");
					var input=document.createElement("input");
					input.setAttribute("type","radio");
					input.setAttribute("name","checks");
					input.setAttribute("id",maps[k].name);
                    input.setAttribute("value",maps[k].value);
                    input.setAttribute("onclick","getvalue(this)");
					var spn=document.createElement("span");
					spn.innerHTML=maps[k].name;
					lab.appendChild(input);
					lab.appendChild(spn);
					p.appendChild(lab);
					sel_sensor.appendChild(p);
                }
                sel_sensor[0].checked=true;
			}
        }
        dp = new DPlayer({
            container: document.getElementById('dplayer'),
            autoplay: false,
            theme: '#FADFA3',
            loop: true,
            lang: 'zh-cn',
            screenshot: true,
            hotkey: true,
            preload: 'auto',
            //logo: 'logo.png',
            volume: 0.7,
            mutex: false, /**/
            video: {
                url: "",//'../mp401.flv',
                //pic: 'dplayer.png',
                //thumbnails: 'thumbnails.jpg',
                type: 'auto',
            },
            
            /*subtitle: {
                url: 'dplayer.vtt',
                type: 'webvtt',
                fontSize: '25px',
                bottom: '10%',
                color: '#b7daff',
            },
            danmaku: {
                id: '9E2E3368B56CDBB4',
                api: 'https://api.prprpr.me/dplayer/',
                token: 'tokendemo',
                maximum: 1000,
                addition: ['https://api.prprpr.me/dplayer/v3/bilibili?aid=4157142'],
                user: 'DIYgod',
                bottom: '15%',
                unlimited: true,
            },
            contextmenu: [
                {
                    text: 'custom1',
                    link: 'https://github.com/DIYgod/DPlayer',
                },
                {
                    text: 'custom2',
                    click: (player) => {
                        console.log(player);
                    },
                },
            ],*/
            highlight: [
                {
                    time: 20,
                    text: '这是第 20 秒',
                },
                {
                    time: 120,
                    text: '这是 2 分钟',
                },
            ],
        });
        /*const dp1 = new DPlayer({
            container: document.getElementById('dplayer1'),
            autoplay: false,
            theme: '#FADFA3',
            loop: true,
            lang: 'zh-cn',
            screenshot: true,
            hotkey: true,
            preload: 'auto',
            //logo: 'logo.png',
            volume: 0.7,
            mutex: false, 
            video: {
                url: '../mp401.flv',
                type: 'auto',
            },
            highlight: [
                {
                    time: 20,
                    text: '这是第 20 秒',
                },
                {
                    time: 120,
                    text: '这是 2 分钟',
                },
            ],
        });*/
        function clickStartRealPlay(){
            var radio=document.getElementsByName("checks");
            sel_id=0;
            for (i=0; i<radio.length; i++) {
                if (radio[i].checked) {
                    sel_id=(radio[i].value)
                }
            }
            var streamtype=document.getElementById("streamtype").value;
            if (sel_id != undefined) {
                //var url=jfjk_base_config.baseurl+"GetHistoriesBySensor?sensorId="+msensorid+"&from="+kssj+"&to="+jssj;
                var url = jfjk_base_config.baseurl + "GetFlv?sensorId="+sel_id+"&type=0&channel="+streamtype+"&_token="+sessionStorage.token;
                url = encodeURI(url);
                //dp.destroy();
                dp = new DPlayer({
                    container: document.getElementById('dplayer'),
                    autoplay: true,
                    theme: '#FADFA3',
                    loop: false,
                    lang: 'zh-cn',
                    screenshot: true,
                    hotkey: true,
                    preload: 'auto',
                    //logo: 'logo.png',
                    volume: 0.7,
                    mutex: false, 
                    video: {
                        url: url,//'../mp401.flv',
                        type: 'auto',
                    },
                    highlight: [
                        {
                            time: 20,
                            text: '这是第 20 秒',
                        },
                        {
                            time: 120,
                            text: '这是 2 分钟',
                        },
                    ],
                });
                //dp.play();
                /*$.ajax({
                    beforeSend: function(request) {
                        //request.setRequestHeader("_token", sessionStorage.token);
                    },
                    url: url,
                    type: 'GET',
                    dataType: 'json',
                    timeout: 10000,
                    error: function() {
                        layer.alert('趋势图数据操作失败');
                    },
                    success: function(data, status) {
                        var reg = new RegExp("(^|&)value1=([^&]*)(&|$)");
                        if (status == "success") {
                            sessionStorage.islogin = true;
                            if (data.Error == null) {
                                if (data.Result.Datas.hasOwnProperty("Tmp")) {
                                    for (var i = 0; i < data.Result.Datas.Tmp.length; i++) {
                                        if (data.Result.Datas.hasOwnProperty("Tmp")) pa.push(data.Result.Datas.Tmp[i].Value);
                                    }

                                } else {
                                    layer.alert("没有符合条件的记录");
                                }
                            } else {
                                layer.alert(data.Error);
                            }
                        }
                    }
                });*/
            }else{
                layer.alert("请选择")
            }
        }
        function clickStopRealPlay(){
            dp.destroy();
        }
        function getvalue(obj){
            sel_id=obj.value;
        }
    </script>
</body>
</html>