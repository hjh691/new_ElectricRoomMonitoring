<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Insert title here</title>
    <style>
html,body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    align: left;
    valign: left;
}
</style>
    <!-- 引入 ECharts 文件 -->
    <script src="./js/echarts.js"></script>
</head>
<body>
<div id="main"
     style="height: 100%; width: 100%; border: 0px; text-align: left; align: left; valign: left;"></div>
<script type="text/javascript">
	 Number_of_decimal=2;
	var data=[{"Time":"2020-06-01 01:35:00","Value":89.5},{"Time":"2020-06-01 01:45:00","Value":44.5},{"Time":"2020-06-01 02:45:34","Value":59.5},{"Time":"2020-06-01 04:47:44","Value":75.5}]
	decodedatas(data);
	//  通用属性定义
    var options = {
                color: ['#FFFF00', '#FF0000','#00ff00'],//
                backgroundColor: '#d0d0d0',
                title : {
                    text : "趋势图"
                },
                tooltip : {
                    show : false
                },
                toolbox : {
                    show : false
                },
                dataZoom: {
						show: true,
						start: 0
					},
					legend: {
						//data: lengenddata,
						orient:"horizontal",//"vertical",
						x:'left',
						y:'30',
						//color: 'white',
					},
            };
        //创建折线图
        function createLineChart(dataArray){
        var pa=[];
        for(var i=0;i<dataArray.length;i++){
            pa.push([strtodatetime(dataArray[i].time),dataArray[i].value,i+1]);
        }
        options = {
        xAxis : [
            {
                type : 'time',
                //boundaryGap : false,
                //data : timeArray,//['第一种','第二种','第三种']
            }
        ],
        yAxis : [
            {
                type : 'value'
            }
        ],
        series : [
            {
                name:'成交',
                type:'line',
                //smooth:true,
                //itemStyle: {normal: {areaStyle: {type: 'default'}}},
                data:pa,//dataArray
             }
            ]
        };
    }
        function createChart(chartKind,dataArray){
            if (chartKind=='line') {
                doCreatChart(createLineChart(dataArray));
            };
            if (chartKind=='bar') {
                doCreatChart(createBarChart(dataArray));
            };
            if (chartKind=='pie') {
                doCreatChart(createPieChart(dataArray));
            };
        }

        function doCreatChart(specificChartFunction){

            /*require(
            ['echarts','echarts/theme/macarons','echarts/chart/line',
            'echarts/chart/bar','echarts/chart/pie'
            ],*/
            //function(ec,theme){
            myChart =echarts.init(document.getElementById('main'));
            //myChart.showLoading({
            //    text : "图表数据正在努力加载..."
            //});
            specificChartFunction;
            myChart.setOption(options); //先把可选项注入myChart中
            //myChart.hideLoading();
            //}
        //);
        }
        function strtodatetime(str) {
            var year = str.substring(0, 4);
            var month = str.substring(5, 7);
            var day = str.substring(8, 10);
            var hour = str.substring(11, 13);
            var minute = str.substring(14, 16);
            var sencond = str.substr(17);
            return new Date(year, month - 1, day, hour, minute, sencond);
        }
        function decodedatas(obj_data){
			kssj="2020-06-01 01:00:01",jssj="2020-06-01 23:00:02";
			var count = 0;
			var maxvalue=0,minvalue=0,avgvalue=0,ps=0,ct=1,maxval=0,minval=0;
			var stime=new Date(kssj).getTime();
			var etime=new Date(jssj).getTime();
			var senconds=etime-stime;
			var pa = [],pb = [],pc = [];
			var jiange="";
			var myChart = echarts.init(document.getElementById('main'));
			myChart.clear();
            if(Math.ceil(senconds/1000/60)<=1440){
				jiange="按小时统计";
				maxvalue=minvalue=avgvalue=parseFloat(obj_data[0].Value);
				maxval=minval=maxvalue;
				var strtime=obj_data[0].Time.substr(0,13);
				var temp=parseInt(strtime.substr(11));
				jisuan(11,13);
				avgvalue=(avgvalue/ct);
				pa.push([strtodatetime(strtime+":00"), maxvalue, ps])
				pb.push([strtodatetime(strtime+":00"), avgvalue.toFixed(Number_of_decimal), ps])
				pc.push([strtodatetime(strtime+":00"),minvalue , ps])
			}else{
				jiange="按日统计";
				maxvalue=minvalue=avgvalue=parseFloat(obj_data[0].Value);
				maxval=minval=maxvalue;
				var strtime=obj_data[0].Time.substr(0,10);
				var temp=parseInt(strtime.substr(8));
				jisuan(8,10);//参数是区日期时间格式串的起始和结束位置的由零算起的索引值。2020-04-16 14:50:10，
				avgvalue=(avgvalue/ct);
				pa.push([strtodatetime(strtime+":00"), maxvalue, ps])
				pb.push([strtodatetime(strtime+":00"), avgvalue.toFixed(Number_of_decimal), ps])
				pc.push([strtodatetime(strtime+":00"),minvalue , ps])
			}
    		count =ps+1;//obj_data.length;
			var lengenddata = [];
			lengenddata.push("最大值");
			lengenddata.push("平均值");
			lengenddata.push("最小值");
			maxval=(maxval*1+(maxval-minval)*0.2).toFixed(Number_of_decimal);
			minval=(minval*1-(maxval-minval)*0.2).toFixed(Number_of_decimal);
			drawchart();
			function drawchart() {
				//var myChart = echarts.init(document.getElementById('main'));
				var option = {
					color: ['#FFFF00', '#FF0000','#00ff00'],//
					backgroundColor: '#d0d0d0',
					title : {
								text : ' 变化趋势图  ',//document.getElementById("jcdd").options[document.getElementById("jcdd").selectedIndex].text+
								x:"center",
								//subtext:jiange+"   "+kssj+"——"+jssj,
								subtextStyle:{
									color: "#000",
								}
							},/**/
					tooltip: {
						trigger: 'item',
						formatter: function(params) {
							var date = new Date(params.value[0]);
							data = date.getFullYear() + '-' + (date.getMonth() + 1) + '-' +
							 date.getDate() + ' ' + date.getHours() + ':' + date.getMinutes();
							return data + '<br/>' + params.value[1];
						}
					},
					toolbox: {
						show: true,
						feature: {
							mark: {
								show: true
							},
							dataView: {
								show: true,
								readOnly: false
							},
							magicType: {
								show: true,
								type: ['line']
							},
							//, 'bar', 'stack', 'tiled'
							restore: {
								show: true
							},
							saveAsImage: {
								show: true
							}
						}
					},
					dataZoom: {
						show: true,
						start: 0
					},
					legend: {
						data: lengenddata,///////////
						orient:"horizontal",//"vertical",
						x:'left',
						y:'30',
						//color: 'white',
					},
					grid: {
						y2: 80
					},
					xAxis: [{
						type: 'time',
						splitNumber: 6,
						axisLine: {
							lineStyle: {
								color: 'black',
								width: 2
							},
							onZero:false
						}
					}],
					yAxis: [{
						type: 'value',
						axisLine: {
							lineStyle: {
								color: 'black',
								width: 2
							}
						},
						min:minval,
						max:maxval,
					}],
					series: [/**/{
						name: lengenddata[0],//document.getElementById("jcdd").options[document.getElementById("jcdd").selectedIndex].text,
						type: 'line',
						showAllSymbol: true,
						symbolSize: 1,
						data: pa
					},
					{
						name: lengenddata[1],//document.getElementById("jcdd").options[document.getElementById("jcdd").selectedIndex].text+"177",
						type: 'line',
						showAllSymbol: true,
						symbolSize: 1,
						data: pb
					},
					{
						name: lengenddata[2],//document.getElementById("jcdd").options[document.getElementById("jcdd").selectedIndex].text+"最小值",
						type: 'line',
						showAllSymbol: true,
						symbolSize: 1,
						data: pc
					}/**/
					]
				};
				myChart.hideLoading();
				myChart.setOption(option);
				myChart.resize;
			}
			function jisuan(a1,a2){
                for (var i = 1; i <obj_data.length; i++) {
					if(parseInt(obj_data[i].Time.substr(a1,a2))==temp){
						if(parseFloat(obj_data[i].Value)>maxvalue){
							maxvalue=parseFloat(obj_data[i].Value);
						}
						if(parseFloat(obj_data[i].Value)<minvalue){
							minvalue=parseFloat(obj_data[i].Value);
						}
						if(parseFloat(obj_data[i].Value)>maxval){
							maxval=parseFloat(obj_data[i].Value);
						}
						if(parseFloat(obj_data[i].Value)<minval){
							minval=parseFloat(obj_data[i].Value);
						}
						avgvalue=(parseFloat(avgvalue)+parseFloat(obj_data[i].Value));
						ct++;
					}else{
						avgvalue=(avgvalue/ct);
						pa.push([strtodatetime(strtime+":00"), maxvalue, ps])
						pb.push([strtodatetime(strtime+":00"), avgvalue.toFixed(Number_of_decimal), ps])
						pc.push([strtodatetime(strtime+":00"),minvalue , ps])
						maxvalue=minvalue=avgvalue=parseFloat(obj_data[i].Value);
						strtime=obj_data[i].Time.substr(0,a2);
						temp=parseInt(strtime.substr(a1));
						ps++;
						ct=1;
					}
				}
			}
		}
    </script>
</body>
</html>