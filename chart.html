<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<link rel="stylesheet" href="css/bootstrap.min.css" />
	<!--script src="js/zrender.min.js"></script-->
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<script type="text/javascript" src="js/jquery-3.3.1.js"></script>
	<script type="text/javascript" src="js/bootstrap.js"></script>
	<script type="text/javascript" src="js/config.js"></script>
	<script type="text/javascript" src="js/cvi_busy_lib.js"></script>
	<script type="text/javascript" src="js/echarts.js"></script>
	<script language="javascript" type="text/javascript" src="My97DatePicker/WdatePicker.js"></script>
	<link rel="stylesheet" href="css/electricroommonitoring.css" />
	<script type="text/javascript" src="js/layer/layer.js"></script>
	<title>趋势图</title>
	<script type="text/javascript" src="js/function.js"></script>
	<style>
		html,
		body,
		#main {
			width: 100%;
			height: 100%;
		}

		ul li {
			display: inline;
			background: #F93;
			padding: 5px;
		}

		span {
			margin-left: 10px;
		}
	</style>
</head>

<body>
	<div>
		<div class="pagecard" id="pagecard1">
			<p style="text-align:center;font-size:20px"><b>历史数据</b></p>
		</div>
		<!--<div style="height:40px;" align="center" style="overflow:scroll;">
			<table class="table" align="center" width="1000px"style="display:none">
			<tr >
			<td style="color:#0000b0;font-size:16px;width:120px;border:0px;"> 计量点名称 :</td>
			<td style="width:100px;border:0px;width:120px;">	
				<select id="jcdd1" style="font-size:16px;width:153px;">
					<option value="0">测温0</option>
				</select>
			</td>
			<td style="width:100px;border:0px;width:120px;">	
				<select id="jcdd2" style="font-size:16px;width:153px;display:none">
					<option value="0">测温0</option>
				</select>
			</td>
			<td style="width:100px;border:0px;width:120px;">	
				<select id="jcdd3" style="font-size:16px;width:153px;display: none">
					<option value="0">测温0</option>
				</select>
			</td>
		</table>
		<table class="table" align="center" width="1000px">
			</tr>
			<tr>
			<td style="color:#0000b0;font-size:16px;width:120px;border:0px;"> 计量点名称 :</td>
			<td style="width:100px;border:0px;width:120px;">	
				<select id="jcdd" style="font-size:16px;width:153px;">
					<option value="0">测温0</option>
				</select>
			</td>
			<td class="condition" style="width:100px;"> 起止时间:</td>
			<td class="condition"><input type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" id="kssj_chart" style="width:190px;" ></input></td>
			<td class="condition" style="width:30px;">至</td>
			<td class="condition"><input type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" id="jssj_chart" style="width:190px;" ></input></td>
			<td class="condition"><input class="button"type="button" id="chaxun" value="查询" onclick="querychartvalue()" ></input></td>
			</tr>
		</table>

		</div>-->
		<div class="parent" style="text-align: center;">
			<div class="column" id="main" align="center"
				style="height:600px;width:1000px;MARGIN-RIGHT: auto; MARGIN-LEFT: auto;margin: 20px;flex:2.5;">
			</div>
			<div class="column" id="fine" align="center"
				style="MARGIN-RIGHT: auto; MARGIN-LEFT: auto;margin: 10px;">
				<div class="rowlay" style="width:100%;text-align: center;font-size:16px;vertical-align: -10%;display: none;"><b>
						<span><a href="javascript:viod(0)" onclick="seletime(0)">当天</a> </span><span><a
								href="javascript:viod(0)" onclick="seletime(1)">昨天</a> </span><span><a
								href="javascript:viod(0)" onclick="seletime(2)">当月</a> </span>
						<span><a href="javascript:viod(0)" onclick="seletime(3)">上月</a> </span><span><a
								href="javascript:viod(0)" onclick="seletime(4)">自定义</a></span>
						<span id="timedefine" > 起止时间
							
								id="kssj_chart" style="width:160px;font-size:16px;height: 30px;"></input>至
							<input type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})"
								id="jssj_chart" style="width:160px;font-size:16px;height: 30px;"></input>
							<input class="button" type="button" id="chaxun" value="查询" onclick="querychartvalue()"
								style="font-size:16px;height: 30px;line-height: 30px;"></input>
						</span></b>
				</div>
				<input>
					<input type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})"></input>
				</div>
				<div>
					计量点名称：
					<select id="jcdd" style="font-size:18px;width:253px;vertical-align:-10%;" onchange="gradeChange()">
					</select>
					<a id="refreshlist" class="glyphicon glyphicon-refresh" href="javascript:void(0)"
						style="margin-left:20px;margin-right: 20px;" onclick="refreshsensorslist()"></a>
				</div>

			</div>
		</div>
	</div>
	<script>
		//初始化历史数据图形显示页面（在进入趋势图页面时触发）。
		inithistorychart();
		function inithistorychart() {

			//return;
			//sessionStorage.pageindex = 4;
			var parentid = -100, parentname = "";
			var maps = [];
			document.getElementById("kssj_chart").value = sessionStorage.kssj;
			document.getElementById("jssj_chart").value = sessionStorage.jssj;
			var sel_sensor = document.getElementById("jcdd");
			////var sel2 = document.getElementById('jcdd2');
			//var sel3 = document.getElementById('jcdd3');
			for (var i = 0; i < sel_sensor.length; i++) {
				sel_sensor.removeChild(sel_sensor.options[0]);
				sel_sensor.remove(0);
				sel_sensor.options[0] = null;
				/*sel2.removeChild(sel2.options[0]);
				sel2.remove(0);
				sel2.options[0] = null;
				sel3.removeChild(sel3.options[0]);
				sel3.remove(0);
				sel3.options[0] = null;*/
			}
			var sensors = JSON.parse(localStorage.getItem("sensors"));
			if (sensors != null) {
				for (var i = 0; i < sensors.length; i++) {
					if ((sensors[i].Value.ParentId != "-1") && (sensors[i].Value.ParentId != parentid)) {
						parentid = sensors[i].Value.ParentId;
						for (var j = 0; j < sensors.length; j++) {
							if (sensors[j].id == parentid) {
								parentname = sensors[j].Value.Name + "_";
								break;
							}
						}
					}
					//var op=document.createElement("option");
					//var op2=document.createElement("option");
					//var op3=document.createElement("option");
					/*op.setAttribute("value",sensors[i].id);
					op.innerHTML=sensors[i].Value.Name;
					sel_sensor.appendChild(op);
					op2.setAttribute("value",sensors[i].Id);
					op2.innerHTML=sensors[i].Value.Name;
					op3.setAttribute("value",sensors[i].Id);
					op3.innerHTML=sensors[i].Value.Name;
					sel2.appendChild(op2);
					sel3.appendChild(op3);*/
					var map = new Object();
					map.value = sensors[i].id;
					map.name = parentname + sensors[i].Value.Name;
					maps.push(map);
				}
				var compare = function (obj1, obj2) {
					var val1 = obj1.name;
					var val2 = obj2.name;
					if (val1 < val2) {
						return -1;
					} else if (val1 > val2) {
						return 1;
					} else {
						return 0;
					}
				}
				maps.sort(compare);
				for (var k = 0; k < maps.length; k++) {
					var op = document.createElement("option");
					op.setAttribute("value", maps[k].value);
					op.innerHTML = maps[k].name;
					sel_sensor.appendChild(op);
				}
			}
			setSelectOption("jcdd", sessionStorage.SensorId);
			querychartvalue();
		}
		function refreshsensorslist() {
			window.parent.GetSensorsByNode(sessionStorage.nodeId);
		}
		function seletime(id) {
			var oneday = 1000 * 60 * 60 * 24;
			var today = new Date();
			var ckssj, cjssj;
			switch (id) {
				case 0:
					sessionStorage.kssj = getCurrentDate(1) + " 00:00:00"; //"2012-09-03T08:00:00";//;
					sessionStorage.jssj = getCurrentDate(2);
					gethistorydata(sessionStorage.SensorId, sessionStorage.kssj, sessionStorage.jssj);
					break;
				case 1:
					ckssj = new Date((getCurrentDate(1) + " 00:00:00").replace(/-/g, "/"));
					var yesterdaystar = ckssj - oneday;
					sessionStorage.kssj = dateToString(new Date(yesterdaystar), 2);
					cjssj = new Date((getCurrentDate(1) + " 23:59:59").replace(/-/g, "/"));
					var yesterdayend = cjssj - oneday;
					sessionStorage.jssj = dateToString(new Date(yesterdayend), 2);
					gethistorydata(sessionStorage.SensorId, sessionStorage.kssj, sessionStorage.jssj);
					break;
				case 2:
					ckssj = new Date((getCurrentDate(1) + " 00:00:00").replace(/-/g, "/"));
					sessionStorage.kssj = dateToString(new Date(ckssj.setDate(1)), 2);
					sessionStorage.jssj = getCurrentDate(2);
					gethistorydata(sessionStorage.SensorId, sessionStorage.kssj, sessionStorage.jssj);
					break;
				case 3:
					ckssj = new Date((getCurrentDate(1) + " 00:00:00").replace(/-/g, "/"));
					var lastMonthFirst = new Date(ckssj - oneday * ckssj.getDate());
					sessionStorage.kssj = dateToString(new Date(lastMonthFirst - oneday * (lastMonthFirst.getDate() - 1)), 2);
					cjssj = new Date((getCurrentDate(1) + " 23:59:59").replace(/-/g, "/"));
					sessionStorage.jssj = dateToString(new Date(cjssj - oneday * cjssj.getDate()), 2);
					gethistorydata(sessionStorage.SensorId, sessionStorage.kssj, sessionStorage.jssj);
					break;
				case 4:
					var timedefine = document.getElementById("timedefine");
					if (timedefine.style.display == "none") {
						timedefine.style.display = "inline";
					} else {
						timedefine.style.display = "none";
					}
					break;
			}
		}
		function gradeChange() {
			var objS = document.getElementById("jcdd");
			sessionStorage.SensorId = objS.options[objS.selectedIndex].value;
			gethistorydata(sessionStorage.SensorId, sessionStorage.kssj, sessionStorage.jssj);
		}
	</script>
</body>

</html>