<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<link rel="stylesheet" href="css/bootstrap.min.css" />
	<link rel="stylesheet" href="css/electricroommonitoring.css"/>
	<title>告警信息</title>
	<script  type="text/javascript" src="js/jquery-3.3.1.js"></script>
	<script type="text/javascript" src="js/bootstrap.js" ></script>
	<script  type="text/javascript" src="js/config.js"></script>
	<script  type="text/javascript" src="js/layer/layer.js"></script>
	<script  type="text/javascript" src="js/cvi_busy_lib.js"></script>
	<script  type="text/javascript" src="js/function.js"></script>
	
	<!--<script  type="text/javascript" src="js/radialIndicator.js"></script>-->
	<script language="javascript" type="text/javascript" src="My97DatePicker/WdatePicker.js"></script>
	<!--<script  type="text/javascript" src="js/cvi_busy_lib.js"></script>-->
	<style>
	*{
       margin:0px;
       padding:0px;
    }
    /**/
    th,td{
        border:1px solid black;
        text-align:center;
        line-height:center;
        width:200px;
        height:30px;
    }
    td{
        border:1px solid black;
        text-align:center;
        line-height:center;
    }
	
            * {
                margin: 0;
                padding: 0;
            }
            
            table {
                /*设置相邻单元格的边框间的距离*/
                border-spacing: 0;
                /*表格设置合并边框模型*/
                border-collapse: collapse;
                text-align: center;
            }
            /*关键设置 tbody出现滚动条height: 450px;overflow-y: scroll;*/
            table tbody {
                display: block;
                
                
            }
            
            table thead,
            tbody tr {
                display: table;
                table-layout: fixed;
            }
            /*关键设置：滚动条默认宽度是16px 将thead的宽度减16pxwidth: 100%;
            
            table thead {
                width: calc( tbody.width )
            }
            
            table thead th {
                background: #ccc;
            }*/
		span{
			margin-left:10px;
		}
	</style>
</head>
<body onload="initwarnlog()">
	<div>
		<div class="pagecard" id="pagecard1" style="margin-bottom:10px">
			<h3 >告警信息</h3>			
		</div>
		<div style="text-align: center;height:30px;" >
		<!--<table class="table" style="border:0px;"align="center">
			<tr >
			<td style="color:#0000b0;font-size:16px;width:120px;border:0px;"> 计量点名称 :</td>
			<td style="width:100px;border:0px;width:120px;">	
				<select id="jcdd" style="font-size:16px;width:153px;">
				</select>
			</td><head>morning</head>affternoon
			<td class="condition"style="width:100px;"> 起止时间:</td>
			<td class="condition"><input  type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})"  id="kssj_warning" style="width:190px;"></input></td>
			<td class="condition" style="width:30px;">至</td>
			<td class="condition"><input  type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" id="jssj_warning" style="width:190px;"></input></td>
			<td class="condition"><input class="button"type="button" id="chaxun" value="查询" onclick="querywarnlog(0)" >
			</input><input class="button"type="button" id="chaxun"style="width:100px" value="查询全站" onclick="querywarnlog(1)" ></input></td>
			</tr>
		</table>-->
			<div class="rowlay" ><b>
				计量点名称：
			<select id="jcdd" onchange="gradeChange()" >
			</select><a id="refreshlist" class="glyphicon glyphicon-refresh" href="javascript:void(0)" onclick="refreshsensorslist()"></a>
			<span ><label><input type="radio" value="0" onclick="seletime(this)" name="timeselect" ></input>当天</label> </span>
			<span ><label><input type="radio" value="1" onclick="seletime(this)" name="timeselect"></input>昨天</label></span>
			<span ><label><input type="radio" value="2" onclick="seletime(this)" name="timeselect"></input>当月</label> </span>
			<span ><label><input type="radio" value="3" onclick="seletime(this)" name="timeselect"></input>上月</label></span>
			<span ><label><input type="radio" value="4" onclick="seletime(this)" name="timeselect"></input>自定义</label></span>
			<span ><label><input type="radio" value="5" onclick="seletime(this)" name="timeselect"></input>实时</label></span>
			<span id="timedefine" style="display: none;">
			起止时间
			<input type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})"  id="kssj_warning" style="width:160px;font-size:16px;height: 30px;"></input>至
			<input type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})"  id="jssj_warning" style="width:160px;font-size:16px;height: 30px;" ></input>
			<input class="button" type="button" id="chaxun" value="查询" onclick="querywarnlog(0)" style="font-size:16px;height: 30px;line-height: 30px;" ></input>
			<input class="button"type="button" id="chaxun"style="width:100px;font-size:16px;height: 30px;line-height: 30px;display:none" value="查询全站" onclick="querywarnlog(1)" ></input></b>
			</span>
			</div>
		<div  class="rowlay" style="margin-bottom:10px; width:100%;display: none;" text-align="center">
			<ul class="count_info" text-align="center" >
				<!--<li style="width:50px"><b>站名：</b></li><span> <a id="realwarnlog" href="javascript:void(0)" onclick="disrealwarnlog()">当前</a></span>-->
				<li id="station_name"style="width:50px;margin-right:10px;display:none"> </li>
				<li style="width:50px;margin-right:10px">记录数：</li>
				<li id="count_val"style="width:50px;margin-right:10px"> </li>
				<!--<li style="width:50px;margin-right:10px"><b>标签名称：</b> </li>
				<li id="normal_count"style="width:150px;margin-right:10px"> </li>
				<li style="width:50px;margin-right:10px"><b>异常数：</b></li>
				<li id="err_count"style="width:50px;margin-right:10px"> </li>
				 -->
				 <li style="width:50px;margin-right:10px"></li>
			</ul>
		</div>
		<div >
			<div style="text-align: center;margin:6px;font-size: 18px;">
			<a id="btn0"></a>
			<input id="pageSize" type="text" size="1" maxlength="3" value="" style="text-align: center;"/><a> 条 </a> <a href="javascript:void(0)" id="pageSizeSet" onclick="setPageSize()">设置</a>&nbsp;
			<a id="sjzl"></a>&nbsp;
			<a  href="javascript:void(0)" id="btn1" onclick="firstPage()">首页</a>
			<a  href="javascript:void(0)" id="btn2" onclick="frontPage()">上一页</a>
			<a  href="javascript:void(0)" id="btn3" onclick="nextPage()">下一页</a>
			<a  href="javascript:void(0)" id="btn4" onclick="LastPage()">尾页</a>&nbsp;
			<a>转到&nbsp;</a>
			<input id="changePage" type="text" size="1" maxlength="4"/>
			<a>页&nbsp;</a>
			<a  href="javascript:void(0)" id="btn5" onclick="changePage()">跳转</a>
			<a href="javascript:void(0)" style="left:50px;text-align:right;margin-left:50px;" onclick="method5('warnlogtable')">导出Excel表格</a>
			<a href="javascript:void(0)" style="left:50px;text-align:right;margin-left:50px;display: none;" onclick="tongji('tongjitable')">统计报表</a>
			</div>
		<table id="warnlogtable" style="margin: auto;">
			<caption id="war_caption" style="text-align: center;font-size:18px;display: none;">告警信息统计报表</caption>
			<tr>
				<th>开始时间</th>
				<th id="tj_kssj"></th>
				<th>终止时间</th>
				<th id="tj_zzsj"></th>
			</tr>
			<tr >
				<th>测量点名称</th>
				<th>告警时间</th>
				<th>数值</th>	
				<th>告警内容</th>
				<!--<th style="width:18px;border:0px solid black;"></th<th>测量点编号</th>>-->
			</tr>
			<tbody id='warnlogdata-tbody' style="width:820px;height:610px; overflow:auto;">
			</tbody>
		</table>
	</div>
	<div id="indicatorContainer"></div>
	</div>
	<script>
	var pageSize = 50;    //每页显示的记录条数
	var curPage=0;        //当前页
	var lastPage;        //最后页
	var direct=0;        //方向
	var len;            //总行数
	var page;            //总页数
	var begin;
	var end;
	var count;
	var $table;
	updatapcnav(8);
	function decodedatas(obj_data){
		objS = document.getElementById("jcdd");
		var name=objS.options[objS.selectedIndex].innerText;
		count = 0;
			$("#warnlogdata-tbody tr").empty();
			$table=document.getElementById("warnlogdata-tbody");
			for(var j=$table.rows.length-1;j>=0;j--){
				$table.removeChild($table.rows[j]);
			}
			document.getElementById("tj_kssj").innerHTML=sessionStorage.kssj;
			document.getElementById("tj_zzsj").innerHTML=sessionStorage.jssj;
			if(obj_data){
				for (var i = 0; i <obj_data.length; i++) {
					if(obj_data[i].Message){
						var tr=document.createElement("tr");
						//if (count % 2 == 0) {
						//	tr.setAttribute('style', "background-color:#16b9c9");
						//}
						//var td_did=document.createElement("td");
						//td_did.innerHTML=objS.options[objS.selectedIndex].value;;
						var td_dname=document.createElement("td");
						td_dname.innerHTML=name;
						var td_dtime=document.createElement("td");
						var time=obj_data[i].Time;//(ttime-oneday*(2*i+5));
						td_dtime.innerHTML=time;//dateToString(new Date(time),2);
						var td_dadr=document.createElement("td");
						var value=obj_data[i].Value;//(Math.random() * 10) - 0;
						td_dadr.innerHTML=(value*1).toFixed(Number_of_decimal);
						var td_dtype=document.createElement("td");
						td_dtype.innerHTML=obj_data[i].Message;//"数值越限";/**/放松警惕保持警戒盯住了
						//tr.appendChild(td_did);
						tr.appendChild(td_dname);
						tr.appendChild(td_dtime);
						tr.appendChild(td_dadr);
						tr.appendChild(td_dtype);
						$table.appendChild(tr);
						count++
					}
				}
				if(!count){
					layer.alert("沒有符合条件的数据");
					document.getElementById("count_val").innerHTML="";
				}else{
					document.getElementById("count_val").innerHTML=count;
				}
				//ps=obj_data.length;
			}
		display();
	}
	function gradeChange() {
		//$("#warnlogdata-tbody tr").empty();
		var tbl = document.getElementById('warnlogdata-tbody');
		var tableLength = tbl.rows.length;
		for (var int = 0; int < tableLength; int++) {
			tbl.deleteRow(0);
		}
		document.getElementById("count_val").innerHTML="";
		var objS = document.getElementById("jcdd");
		sessionStorage.SensorId = objS.options[objS.selectedIndex].value;
		gethistorydata(sessionStorage.SensorId,sessionStorage.kssj,sessionStorage.jssj);
	}
	function stopWorker() 
		{ 
			w1.terminate();
			w1 = undefined;
		};
	function showrealworning(){
		//document.getElementById("jcdd").disabled=true;
		var timedefine=document.getElementById("timedefine");
		timedefine.style.display="none";
		var warningtab = window.parent.document.getElementById("realwarningdata-tbody");
		var trs = warningtab.getElementsByTagName("tr");
		document.getElementById("tj_kssj").innerHTML="";
		document.getElementById("tj_zzsj").innerHTML="";
		$table = document.getElementById("warnlogdata-tbody");
		var trl = document.createElement('tr');
		if ($table == null) {
			$table = iframe_main.document.getElementById("warnlogdata-tbody");
		}
		var rowNum = $table.rows.length;
		for (var i = 0; i < rowNum; i++) {
			tr = $table.rows[0];
			$table.removeChild(tr);
		}
		for (var i = 0; i < trs.length; i++) {//
			$table.appendChild($(trs[i].outerHTML)[0]);
		}
		//var counter = document.getElementById("count_varning");
		//if (counter == null) {
		//	counter = iframe_main.document.getElementById("count_varning");
		//}
		//counter.innerHTML = tbl.rows.length;
		//moduletable('warnlogdata-tbody');
		display();
	}
	function display(){   
		//var $table=$("#warnlogdata-tbody");
		if(!$table){
			return;
		}
		len =$table.rows.length ;//- 1;    // 求这个表的总行数，剔除第一行介绍
		page=len % pageSize==0 ? len/pageSize : Math.floor(len/pageSize)+1;//根据记录条数，计算页数
		// alert("page==="+page);
		curPage=1;    // 设置当前为第一页
		displayPage(1);//显示第一页
		document.getElementById("btn0").innerHTML="当前 " + curPage + "/" + page + " 页    每页 ";    // 显示当前多少页
		document.getElementById("sjzl").innerHTML="数据总量 " + len + "";        // 显示数据量
		document.getElementById("pageSize").value = pageSize;
	}
		function firstPage(){    // 首页
			curPage=1;
			direct = 0;
			displayPage();
		}
		function frontPage(){    // 上一页
			direct=-1;
			displayPage();
		}
		function nextPage(){    // 下一页
			direct=1;
			displayPage();
		}
		function LastPage(){    // 尾页
			curPage=page;
			direct = 0;
			displayPage();
		}
		function changePage(){    // 转页
			curPage=document.getElementById("changePage").value * 1;
			if (!/^[1-9]\d*$/.test(curPage)) {
				layer.alert("请输入正整数");
				return ;
			}
			if (curPage > page) {
				layer.alert("超出数据页面");
				return ;
			}
			direct = 0;
			displayPage();
		}
		function setPageSize(){    // 设置每页显示多少条记录
			pageSize = document.getElementById("pageSize").value;    //每页显示的记录条数
			if (!/^[1-9]\d*$/.test(pageSize)) {
				layer.alert("请输入正整数");
				return ;
			}
			len =$table.rows.length - 1;
			page=len % pageSize==0 ? len/pageSize : Math.floor(len/pageSize)+1;//根据记录条数，计算页数
			curPage=1;        //当前页
				direct=0;        //方向
				firstPage();
				displayPage();
		}
	function displayPage(){
		if(curPage <=1 && direct==-1){
			direct=0;
			layer.alert("已经是第一页了");
			return;
		} else if (curPage >= page && direct==1) {
			direct=0;
			layer.alert("已经是最后一页了");
			return ;
		}
		lastPage = curPage;
		// 修复当len=1时，curPage计算得0的bug
		if (len > pageSize) {
			curPage = ((curPage + direct + len) % len);
		} else {
			curPage = 1;
		}
		document.getElementById("btn0").innerHTML="当前 " + curPage + "/" + page + " 页    每页 ";        // 显示当前多少页
		begin=(curPage-1)*pageSize ;// 起始记录号
		end = begin + 1*pageSize ;    // 末尾记录号
		if(end > len ) end=len;
		//var theTable=$("#warnlogdata-tbody");// document.getElementById("warnlogdata-tbody");
		for ( var i = 0; i<len; i++ ) {
			$table.rows[i].style.display = 'none';
		}
		for ( var i = begin; i<end; i++ ) {
			$table.rows[i].style.display = '';
		}
		/*$table.find("tr").hide();    // 首先，设置这行为隐藏
		$table.find("tr").each(function(i){    // 然后，通过条件判断决定本行是否恢复显示
			if((i>=begin && i<=end) )//显示begin<=x<=end的记录
				$(this).show();
		});*/

		}
	</script>
</body>
</html>