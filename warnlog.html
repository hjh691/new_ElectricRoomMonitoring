<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<link rel="stylesheet" href="css/bootstrap.min.css" />
	<link rel="stylesheet" href="css/electricroommonitoring.css"/>
	<title>告警信息</title>
	<script  type="text/javascript" src="js/jquery-3.3.1.js"></script>
	<script type="text/javascript" src="js/bootstrap.js" ></script>
	<script  type="text/javascript" src="js/config.js"></script>
	<script  type="text/javascript" src="js/layer/layer.js"></script>
	<script type="text/javascript" src="js/jquery.table2excel.min.js"></script>
	<script  type="text/javascript" src="js/cvi_busy_lib.js"></script>
	<script  type="text/javascript" src="js/function.js"></script>
	
	<!--<script  type="text/javascript" src="js/radialIndicator.js"></script>-->
	<script language="javascript" type="text/javascript" src="My97DatePicker/WdatePicker.js"></script>
	<!--<script  type="text/javascript" src="js/cvi_busy_lib.js"></script>-->
	<style>
	*{
       margin:0px;
       padding:0px;
    }
    /**/
    th,td{
        border:1px solid black;
        text-align:center;
        line-height:center;
        width:200px;
        height:30px;
    }	
	table {
		/*设置相邻单元格的边框间的距离*/
		border-spacing: 0;
		/*表格设置合并边框模型*/
		border-collapse: collapse;
		text-align: center;
	}
	/*关键设置 tbody出现滚动条height: 450px;overflow-y: scroll;*/
	table tbody {
		display:block ;
	}
	/*tbody tr {
		display: table;
		table-layout: fixed;
	}
	关键设置：滚动条默认宽度是16px 将thead的宽度减16pxwidth: 100%;
	
	table thead {
		width: calc( tbody.width )
	}
	
	table thead th {
		background: #ccc;
	}*/
	span{
		margin-left:10px;
	}
	</style>
</head>
<body >
	<div>
		<div class="pagecard" id="pagecard1" style="margin-bottom:10px;display: none;">
			<h3 >告警信息</h3>			
		</div>
		<!--<div style="text-align: center;height:30px;" onload="initwarnlog()">
		<table class="table" style="border:0px;"align="center">
			<tr >
			<td style="color:#0000b0;font-size:16px;width:120px;border:0px;"> 计量点名称 :</td>
			<td style="width:100px;border:0px;width:120px;">	
				<select id="jcdd" style="font-size:16px;width:153px;">
				</select>
			</td><head>morning</head>affternoon
			<td class="condition"style="width:100px;"> 起止时间:</td>
			<td class="condition"><input  type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})"  id="kssj_warning" style="width:190px;"></input></td>
			<td class="condition" style="width:30px;">至</td>
			<td class="condition"><input  type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})" id="jssj_warning" style="width:190px;"></input></td>
			<td class="condition"><input class="button"type="button" id="chaxun" value="查询" onclick="querywarnlog(0)" >
			</input><input class="button"type="button" id="chaxun"style="width:100px" value="查询全站" onclick="querywarnlog(1)" ></input></td>
			</tr>
		</table>-->
		<div style="margin-bottom: 0;" >
			<span class="condition" >
				<label>计量点名称：</label>
			<select id="jcdd" onchange="gradeChange()"  style="border-radius: 5px;">
			</select ><a id="refreshlist" class="glyphicon glyphicon-refresh" href="javascript:void(0)" onclick="refreshsensorslist()" style="display:none"></a>
			</span>
			<span><label>显示内容：</label></span>
			<span id="display_type" class="btn-group" data-toggle="buttons">
				<label class="btn btn-primary active"><input type="radio" class="catalog" name="options" value="">全部</label>
			</span>
			
			<div class="condition" >
				<span><label>事件类型：</label></span>
				<span class="dropup" style="position: relative;">
				<!--<button class="btn btn-default dropdown-toggle form-control select_multiple" style="width: 90px;margin-left: 0px;" type="button" id="dropdownMenu21" data-toggle="dropdown">
					<span class="select_text" data-is-select="false">Dro pup</span>
					<span class="caret"></span>
				</button>-->
				<label class="dropdown-toggle select_multiple" data-toggle="dropdown">
					<input id="select_text" class="select_text " data-is-select="false" style="line-height: 25px;color:black;border-radius: 5px;"></input>
				</label>
				<ul class="dropdown-menu dropdown_item" style="bottom: auto;" id="event_type">
					<!-- 为了方便演示，type设置text了，实际中可以设置成hidden<li><label><input type="checkbox" class="check_box" value="aa" /> <span>越上限</span></label></li>
					<li><label><input type="checkbox" class="check_box" value="bb" /> <span>越下限</span></label></li> -->
				</ul>
				</span>
				<span ><label><input type="radio" value="5" onclick="seletime(this)" name="timeselect"></input>实时</label></span>
				<span ><label><input type="radio" value="0" onclick="seletime(this)" name="timeselect" ></input>当天</label> </span>
				<span ><label><input type="radio" value="1" onclick="seletime(this)" name="timeselect"></input>昨天</label></span>
				<span ><label><input type="radio" value="2" onclick="seletime(this)" name="timeselect"></input>当月</label> </span>
				<span ><label><input type="radio" value="3" onclick="seletime(this)" name="timeselect"></input>上月</label></span>
				<span ><label title="自定义起止时间"><input type="radio" value="4" onclick="seletime(this)" name="timeselect"></input>自定义</label></span>
				<span id="timedefine" style="display: none;">
				起止时间
				<input type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})"  id="kssj_warning" style="width:160px;font-size:16px;height: 30px;"></input>至
				<input type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})"  id="jssj_warning" style="width:160px;font-size:16px;height: 30px;" ></input>
				<input class="button" type="button" id="chaxun" value="查询" onclick="querywarnlog(0)" style="font-size:16px;height: 30px;line-height: 30px;" ></input>
				<input class="button"type="button" id="chaxun"style="width:100px;font-size:16px;height: 30px;line-height: 30px;display:none" value="查询全站" onclick="querywarnlog(1)" ></input></b>
				</span>
			</div>
		</div>
		<div  class="rowlay" style="margin-bottom:10px; width:100%;display: none;" text-align="center">
			<ul class="count_info" text-align="center" >
				<!--<li style="width:50px"><b>站名：</b></li><span> <a id="realwarnlog" href="javascript:void(0)" onclick="disrealwarnlog()">当前</a></span>-->
				<li id="station_name"style="width:50px;margin-right:10px;display:none"> </li>
				<li style="width:50px;margin-right:10px">记录数：</li>
				<li id="count_val"style="width:50px;margin-right:10px"> </li>
				<!--<li style="width:50px;margin-right:10px"><b>标签名称：</b> </li>
				<li id="normal_count"style="width:150px;margin-right:10px"> </li>
				<li style="width:50px;margin-right:10px"><b>异常数：</b></li>
				<li id="err_count"style="width:50px;margin-right:10px"> </li>method5('warnlogtable')-->
				 <li style="width:50px;margin-right:10px"></li>
			</ul>
		</div>
		<div text-align="center">
			
			<table id="warnlogtable" style="margin: auto;">
				<caption id="war_caption" style="text-align: center;font-size:22px;color:black;">告警信息统计表</caption>
				<tr>
					<th>开始时间</th>
					<th id="tj_kssj"></th>
					<th>终止时间</th>
					<th id="tj_zzsj"></th>
				</tr>
				<tr>
					<th>越上限</th>
					<th id="count_first"></th>
					<th id="count_second">越下限</th>
					<th id="count_third"></th>
				</tr>
				<tr >
					<th style="display: none;">测量点编号</th>
					<th>测量点名称</th>
					<th>告警时间</th>
					<th>数值</th>	
					<th>告警内容</th>
					<!--<th style="width:18px;border:0px solid black;"></th<th>测量点编号</th>>-->
				</tr>
				<tbody id='warnlogdata-tbody' style="width:820px;height:540px; overflow:auto;">
				</tbody>
			</table>
			<div style="text-align: center;margin:6px;font-size: 18px;">
				<a id="btn0"></a>
				<input id="pageSize" type="text" size="1" maxlength="3" value="" style="text-align: center;"/><a> 条 </a> <a href="javascript:void(0)" id="pageSizeSet" onclick="setPageSize()">设置</a>&nbsp;
				<a id="sjzl"></a>&nbsp;
				<a  href="javascript:void(0)" id="btn1" onclick="firstPage()">首页</a>
				<a  href="javascript:void(0)" id="btn2" onclick="frontPage()">上一页</a>
				<a  href="javascript:void(0)" id="btn3" onclick="nextPage()">下一页</a>
				<a  href="javascript:void(0)" id="btn4" onclick="LastPage()">尾页</a>&nbsp;
				<a>转到&nbsp;</a>
				<input id="changePage" type="text" size="1" maxlength="4"/>
				<a>页&nbsp;</a>
				<a  href="javascript:void(0)" id="btn5" onclick="changePage()">跳转</a>
				<a href="javascript:void(0)" style="left:50px;text-align:right;margin-left:50px;" onclick="exporttoexcel('warnlogtable')">
					<img src="res/gif_export.gif" alt="Big Boat" title="导出到Excel" class="img-thumbnail img-responsive"></a>
				<a href="javascript:void(0)" style="left:50px;text-align:right;margin-left:50px;display:none;" id="tongji" onclick="tongji('tongjitable')">告警统计</a>
			</div>
			<!--<table id="tongjitable" style="margin:auto;display: none;">
				<tr>
					<th >测量点名称</th>
					<th id="cldmc"></th>
					<th>统计时间</th>
					<th id="tjsj"></th>
				</tr>
				<tr>
					<th></th>
					<th >一级告警</th>
					<th>二级告警</th>
					<th>三级告警</th>
				</tr><th>告警次数</th>-->
				
				<!--<tr >
					<th colspan="4">一级告警</th>
				</tr>
				<tr >
					<th>测量点名称</th>
					<th>告警时间</th>
					<th>数值</th>	
					<th>告警内容</th>
				</tr>
				<tbody id="tb_first"></tbody>
			</table>-->
		</div>
		<div id="indicatorContainer"></div>
	</div>
	<script>
	var pageSize = 50;    //每页显示的记录条数
	var curPage=0;        //当前页
	//var lastPage;        //最后页
	var direct=0;        //方向
	var len;            //总行数
	var page;            //总页数
	var begin;
	var end;
	var count,count_l=0,count_h=0;
	var $table;
	var configs;
	var name="",catalog="";
	initwarnlog();
	updatapcnav(8);
	$(function () {
		$(".btn").click(function(){
			$(this).button('toggle');
			name= $(".catalog:checked").val();
			getcatalog(name);
			gethistorydata(sessionStorage.SensorId,catalog,name,sessionStorage.kssj,sessionStorage.jssj);
		});
		
	});
	function getcatalog(aname){
		if(aname==""){
			catalog="";
			return;
		}
		if(configs){
			for(var p in configs){
				for(var l in configs[p]){
					if(configs[p][l].Name==name){
						catalog=configs[p][l].Catalog;
						return;
					}
				}
			}
		}
	}
	//初始化告警信息查询页面（在进入告警信息页面时触发）。  used by electricroommonitor
function initwarnlog() {
	var parentid=-100,parentname="";
	var maps=[];
	sessionStorage.pageindex = 5;
	document.getElementById("kssj_warning").value = sessionStorage.kssj;
	document.getElementById("jssj_warning").value = sessionStorage.jssj;
	var sel_sensor=document.getElementById("jcdd");
	for (var i = 0; i < sel_sensor.length; i++) {
		sel_sensor.removeChild(sel_sensor.options[0]);
		sel_sensor.remove(0);
		sel_sensor.options[0] = null;
	}
	sensors=JSON.parse(localStorage.getItem("sensors"));
	configs=JSON.parse(localStorage.getItem("Configs"));
	if(sensors!=null){
		for(var i=0;i<sensors.length;i++){
			if((sensors[i].Value.ParentId!="-1")&&(sensors[i].Value.ParentId!=parentid)){
				parentid=sensors[i].Value.ParentId;
				for(var j=0;j<sensors.length;j++){
					if(sensors[j].id==parentid){
						parentname=sensors[j].Value.Name+"_";
						break;
					}
				}
			}
			var map=new Object();
			map.value=sensors[i].id;
			map.name=parentname+sensors[i].Value.Name;
			maps.push(map);
		}
		var compare = function (obj1, obj2) {
			var val1 = obj1.name;
			var val2 = obj2.name;
			if (val1 < val2) {
				return -1;
			} else if (val1 > val2) {
				return 1;
			} else {
				return 0;
			}            
		} 
		maps.sort(compare);
		for(var k=0;k<maps.length;k++){
			var op=document.createElement("option");
			op.setAttribute("value",maps[k].value);
			op.innerHTML=maps[k].name;
			sel_sensor.appendChild(op);
		}
		appenddisplaytype();
	}
	setSelectOption("jcdd", sessionStorage.SensorId);
	sessionStorage.SensorId = sel_sensor.value;
	if(sessionStorage.SensorId=="")
		sessionStorage.SensorId=-1;
	//GetSensorsByStation();
	if((!sessionStorage.timeindex)||(typeof(sessionStorage.timeindex)=="undefined")){
		sessionStorage.timeindex=0;
	}
	$(":radio[name='timeselect'][value='"+sessionStorage.timeindex+"']").prop("checked","checked");
	seletime($(":radio[name='timeselect'][value='"+sessionStorage.timeindex+"']")[0]);
	if(sessionStorage.timeindex==4){
		querywarnlog();
	}
	if(typeof(Worker) !== "undefined") {//只在网络状态下可用，本地磁盘目录下不可用。
		if(typeof(w1) == "undefined") {
			w1 = new Worker("delay_worker.js");
		}
		var i=0;
		w1.onmessage = function(event) {
			//document.getElementById("result").innerHTML = event.data;
			i++
			if(i%60==0){
				if(sessionStorage.timeindex==5)
				showrealworning();
			}
		};
	} else {
		var t1 = window.setInterval("getrealdatabynodeid(-1);",60000);
	}
	function appenddisplaytype(){
		if(sessionStorage.SensorId>=0){
			for(var k=0;k<sensors.length;k++){
				if(sensors[k].Value.Id==sessionStorage.SensorId){
					allcatalog=sensors[k].Value.Catalog;//读取对应的Catalog项
					break;
				}
			}
			if(configs.hasOwnProperty(allcatalog)){//检查配置中是否有catalog项
				var s_des=configs[allcatalog]//如果有，读取其所有配置项
				for(var p in s_des){
					var lab=document.createElement("label");
					/*if(p==0){
						name=s_des[p].Name;
						catalog=s_des[p].Catalog;
						lab.className="btn btn-primary active"
					}else{}*/
					lab.className="btn btn-primary";
					
					lab.innerHTML='<input class="catalog" type="radio" name="options" value="'+s_des[p].Name+'" >'+s_des[p].Desc;
					document.getElementById("display_type").appendChild(lab);
					
					if(s_des[p].Catalog=="event"&&s_des[p].Name=="event"){
						var config=new Object()
						config=JSON.parse(s_des[p].Config);
						if(config){
							for(var c in config){
								var li=document.createElement("li");
								var lab=document.createElement("label");
								//lab.setAttribute("style","margin-left:20px")
								var ainput=document.createElement("input");
								ainput.setAttribute("type","checkbox");
								ainput.setAttribute("name","checkbox");
								ainput.setAttribute("value",c);
								ainput.className="check_box";
								var spn=document.createElement("span");
								spn.innerHTML=config[c];
								lab.appendChild(ainput);
								lab.appendChild(spn);
								//lab.innerHTML='<input class="catalog" type="checkbox" name="options" value="'+s_des[p].Name+'" >'+s_des[p].Desc;
								li.appendChild(lab);
								document.getElementById("event_type").appendChild(li);
							}
						}
					}
				}
			}
		}
	}
}
	function decodedatas(obj_data){
		objS = document.getElementById("jcdd");
		var name;
		var sift=false;
		if(objS.options.length>0){
			name=objS.options[objS.selectedIndex].innerText;
		}
		var type_str=[];
		var count = 0;
		var count_l=[];
			$("#warnlogdata-tbody tr").empty();
			$table=document.getElementById("warnlogdata-tbody");
			for(var j=$table.rows.length-1;j>=0;j--){
				$table.removeChild($table.rows[j]);
			}
			document.getElementById("tj_kssj").innerHTML=sessionStorage.kssj;
			document.getElementById("tj_zzsj").innerHTML=sessionStorage.jssj;
			if(obj_data&&obj_data.length>0){
				var warning_type=document.getElementById("select_text").value;
				if(warning_type.length>0){
					type_str=warning_type.split(";");
					sift=true;
				}else{
					warning_type="越上限;越下限";
					type_str=warning_type.split(";");
					sift=false;
				}
				var tr_arr=[],td_arr=[];
				for(var j=0;j<=type_str.length;j++){
					count_l[j]=0;
					window.eval("var tr"+j+"=document.createElement('tr');");
					window.eval("tr"+j+'.setAttribute("id","tr'+j+'")');
					window.eval("var td"+j+"=document.createElement('td');");
					window.eval("td"+j+".setAttribute('id','td"+j+"')");
					window.eval("td"+j+".setAttribute('colspan','4')");
					if(j==type_str.length){
						window.eval("td"+j+".setAttribute('style','display:none')");
						window.eval("tr"+j+".setAttribute('style','display:none')");
					}
					window.eval("td"+j+".innerHTML='"+type_str[j]+"'");
					window.eval("tr"+j+".appendChild(td"+j+")");
					window.eval("tr"+j+".setAttribute('style','color:#f20')");
					
					$table.appendChild(window.eval("tr"+j));
					//console.log(window.eval("tr"+j));
				}
				/**
				 * think about can't wait to do heard a lot  about him on silk roat learning language true 
				**/
				/*var tr1=document.createElement("tr");
				tr1.setAttribute("id","tr1");
				var td_first=document.createElement("td");
				td_first.setAttribute("colspan","4");
				td_first.innerHTML=warning_sign_hight;
				td_first.setAttribute("id","td1")
				//td_first.setAttribute('style','display:none');
				//tr1.setAttribute('style','display:none');
				tr1.appendChild(td_first);
				tr1.setAttribute("style","background-color:#f70");
				$table.appendChild(tr1);
				var tr2=document.createElement("tr");
				tr2.setAttribute("id","tr2");
				//tr2.setAttribute("style","display:none");
				tr2.setAttribute("style","background-color:#07f");
				var td_second=document.createElement("td");
				td_second.setAttribute("id","td2")
				td_second.innerHTML=warning_sign_low;
				//td_second.setAttribute('style','display:none');
				td_second.setAttribute("colspan","4");
				tr2.appendChild(td_second);
				$table.appendChild(tr2);
				var tr3=document.createElement("tr");
				tr3.setAttribute("style","display:none");
				var td_third=document.createElement("td");
				td_third.setAttribute('style','display:none');
				td_third.setAttribute("colspan","4");
				tr3.appendChild(td_third);
				$table.appendChild(tr3);*/
				for (var i = 0; i <obj_data.length; i++) {
					if(obj_data[i].Message){
						var tr=document.createElement("tr");
						tr.setAttribute("onclick","tableclick(this)");
						var td_did=document.createElement("td");
						td_did.innerHTML=objS.options[objS.selectedIndex].value;
						td_did.setAttribute("style","display:none");
						var td_dname=document.createElement("td");
						td_dname.innerHTML=name;
						var td_dtime=document.createElement("td");
						var time=obj_data[i].Time;//(ttime-oneday*(2*i+5));
						td_dtime.innerHTML=time;//dateToString(new Date(time),2);
						var td_dadr=document.createElement("td");
						var value=obj_data[i].Value;//(Math.random() * 10) - 0;
						td_dadr.innerHTML=(value*1).toFixed(Number_of_decimal);
						var td_dtype=document.createElement("td");
						td_dtype.innerHTML=obj_data[i].Message;//"数值越限";/**/放松警惕保持警戒盯住了
						tr.appendChild(td_did);
						tr.appendChild(td_dname);
						tr.appendChild(td_dtime);
						tr.appendChild(td_dadr);
						tr.appendChild(td_dtype);
						for(var j=0;j<type_str.length;j++){
							if(obj_data[i].Message.indexOf(type_str[j])!=-1){
								$table.insertBefore(tr,window.eval("tr"+(j+1)));
								count_l[j]=count_l[j]+1;
								count++;
								break;
							}/*else if(obj_data[i].Message==warning_sign_hight){
								$table.insertBefore(tr,tr1);
								count_h++;
							}else{
								$table.appendChild(tr);
							}*/
						}
						if ((j>=type_str.length)&&(!sift)){//20200403
							$table.appendChild(tr);
							count++;
						}
					}
				}
				if(!count){
					layer.alert("沒有符合条件的数据",info_showtime);
					document.getElementById("count_val").innerHTML="";
					document.getElementById("count_first").innerHTML="";
					document.getElementById("count_third").innerHTML="";
					document.getElementById("tr0").style.display="none";
					document.getElementById("td0").style.display="none";
					document.getElementById("tr1").style.display="none";
					document.getElementById("td1").style.display="none";
					document.getElementById("count_first").innerHTML=0;
					document.getElementById("count_third").innerHTML=0;
				}else{
					for(var i=0;i<type_str.length;i++){
						if(count_l[i]==0){
							//document.getElementById(window.eval("'td"+i+"'")).style.display="none";
							var dtr=document.getElementById(window.eval("'tr"+i+"'"));//;//.style.display="none";
							$table.removeChild(dtr);//去掉统计为零的标题行
						}
					}
					/*if(count_h==0){
						document.getElementById("tr0").style.display="none";
						document.getElementById("td0").style.display="none";
					}
					if(count_l==0){
						document.getElementById("tr1").style.display="none";
						document.getElementById("td1").style.display="none";
					}*/
					document.getElementById("count_val").innerHTML=count;
					document.getElementById("count_first").innerHTML=count_l[0];
					document.getElementById("count_third").innerHTML=count_l[1];
					var dtr=document.getElementById(window.eval("'tr"+type_str.length+"'"));
					$table.removeChild(dtr);//去掉最后一行（插入参考行
				}
				//ps=obj_data.length;
			}else{
				document.getElementById("count_first").innerHTML=0;
				document.getElementById("count_third").innerHTML=0;
			}
		display();
	}
	function tableclick(tr){
		$(tr).siblings().css("background","");
		$(tr).css("background",color_table_cur);//区分选中行
	}
	function add_sign(){
	}
	function gradeChange() {
		//$("#warnlogdata-tbody tr").empty();
		var tbl = document.getElementById('warnlogdata-tbody');
		var tableLength = tbl.rows.length;
		for (var int = 0; int < tableLength; int++) {
			tbl.deleteRow(0);
		}
		document.getElementById("count_val").innerHTML="";
		var objS = document.getElementById("jcdd");
		sessionStorage.SensorId = objS.options[objS.selectedIndex].value;
		gethistorydata(sessionStorage.SensorId,catalog,name,sessionStorage.kssj,sessionStorage.jssj);
	}
	function stopWorker() 
		{ 
			w1.terminate();
			w1 = undefined;
		};
	function showrealworning(){
		//document.getElementById("jcdd").disabled=true;
		var sift=false;
		count_l=[0,0];//count_h=0;
		var timedefine=document.getElementById("timedefine");
		timedefine.style.display="none";
		var warningtab = window.parent.document.getElementById("realwarningdata-tbody");
		var trs = warningtab.getElementsByTagName("tr");
		document.getElementById("tj_kssj").innerHTML="";
		document.getElementById("tj_zzsj").innerHTML="";
		$table = document.getElementById("warnlogdata-tbody");
		var trl = document.createElement('tr');
		if ($table == null) {
			$table = iframe_main.document.getElementById("warnlogdata-tbody");
		}
		var rowNum = $table.rows.length;
		for (var i = 0; i < rowNum; i++) {
			tr = $table.rows[0];
			$table.removeChild(tr);
		}
		if(trs.length>0){
			/**
			 * 在表格中定义一些关键节点（行），采用insertbifore命令时的参考节点。
			 * 用于对表格中的数据进行分类插入，并作为分类显示的标题。tr1,tr2...
			 * **/
			 var warning_type=document.getElementById("select_text").value;
			if(warning_type.length>0){
				type_str=warning_type.split(",");
				sift=true;
			}else{
				warning_type="越上限,越下限";
				type_str=warning_type.split(",");
				sift=false;
			}
			var tr_arr=[],td_arr=[];
			for(var j=0;j<=type_str.length;j++){
				count_l[j]=0;
				window.eval("var tr"+j+"=document.createElement('tr');");
				window.eval("tr"+j+'.setAttribute("id","tr'+j+'")');
				window.eval("var td"+j+"=document.createElement('td');");
				window.eval("td"+j+".setAttribute('id','td"+j+"')");
				window.eval("td"+j+".setAttribute('colspan','4')");
				if(j==type_str.length){
					window.eval("td"+j+".setAttribute('style','display:none')");
					window.eval("tr"+j+".setAttribute('style','display:none')");
				}
				window.eval("td"+j+".innerHTML='"+type_str[j]+"'");
				window.eval("tr"+j+".appendChild(td"+j+")");
				window.eval("tr"+j+".setAttribute('style','color:#f20')");
				$table.appendChild(window.eval("tr"+j));
				//console.log(window.eval("tr"+j));
			}
			for (var i = 0; i < trs.length; i++) {//
				//warning_sign_low、warning_sign_hight为判断标准，在config.js里定义内容，
				/*if(trs[i].cells[5].innerText==warning_sign_low){
					$table.insertBefore($(trs[i].outerHTML)[0],tr3);
					count_l++;
				}else if(trs[i].cells[5].innerText==warning_sign_hight){
					$table.insertBefore($(trs[i].outerHTML)[0],tr2);
					count_h++;
				}*/
				for(var j=0;j<type_str.length;j++){
					if(trs[i].cells[4].innerText==type_str[j]){
						var tr=document.createElement("tr");
						tr=$(trs[i].outerHTML)[0];
						tr.setAttribute("onclick","tableclick(this)");
						$table.insertBefore(tr,window.eval("tr"+(j+1)));
						count_l[j]=count_l[j]+1;
						count++;
						break;
					}
					count++
				}
				if((j>=type_str.length)&&(!sift)){
					$table.appendChild($(trs[i].outerHTML)[0]);
					count++;
				}
			}
			for(var i=0;i<type_str.length;i++){
				if(count_l[i]==0){
					//document.getElementById(window.eval("'td"+i+"'")).style.display="none";
					var dtr=document.getElementById(window.eval("'tr"+i+"'"));//;//.style.display="none";
					$table.removeChild(dtr);//去掉统计为零的标题行 
				}
			}
			var dtr=document.getElementById(window.eval("'tr"+type_str.length+"'"));//20200403
			$table.removeChild(dtr);//去掉最后一行（插入参考行）
		}else{
			layer.alert("当前没有告警!",info_showtime)
		}
		document.getElementById("count_first").innerHTML=count_l[0];
		document.getElementById("count_third").innerHTML=count_l[1];
		display();
	}
	function refreshsensorslist(){
		window.parent.GetSensorsByNode(sessionStorage.nodeId);
	}
	/*function tongji(){
		var txt_tj=document.getElementById("tongji");
		if(txt_tj.innerText=="告警统计"){
			txt_tj.innerText="告警查询"
			document.getElementById("warnlogtable").style.display="none";
			document.getElementById("tongjitable").style.display="";
		}else{
			txt_tj.innerText="告警统计"
			document.getElementById("warnlogtable").style.display="";
			document.getElementById("tongjitable").style.display="none";
		}
	}*/


	function display(){   
		//var $table=$("#warnlogdata-tbody");
		if(!$table){
			return;
		}
		len =$table.rows.length ;    //- 1;// 求这个表的总行数，剔除第一行介绍
		page=len % pageSize==0 ? len/pageSize : Math.floor(len/pageSize)+1;//根据记录条数，计算页数
		// alert("page==="+page);
		curPage=1;    // 设置当前为第一页
		displayPage(1);//显示第一页
		document.getElementById("btn0").innerHTML="当前 " + curPage + "/" + page + " 页    每页 ";    // 显示当前多少页
		document.getElementById("sjzl").innerHTML="数据总量 <span class='badge' style='font-size:18px'>" + len + "";        // 显示数据量
		document.getElementById("pageSize").value = pageSize;
	}
		function firstPage(){    // 首页
			curPage=1;
			direct = 0;
			displayPage();
		}
		function frontPage(){    // 上一页
			direct=-1;
			displayPage();
		}
		function nextPage(){    // 下一页
			direct=1;
			displayPage();
		}
		function LastPage(){    // 尾页
			curPage=page;
			direct = 0;
			displayPage();
		}
		function changePage(){    // 转页
			curPage=document.getElementById("changePage").value * 1;
			if (!/^[1-9]\d*$/.test(curPage)) {
				layer.alert("请输入正整数",info_showtime);
				return ;
			}
			if (curPage > page) {
				layer.alert("超出数据页面",info_showtime);
				return ;
			}
			direct = 0;
			displayPage();
		}
		function setPageSize(){    // 设置每页显示多少条记录
			pageSize = document.getElementById("pageSize").value;    //每页显示的记录条数
			if (!/^[1-9]\d*$/.test(pageSize)) {
				layer.alert("请输入正整数",info_showtime);
				return ;
			}
			len =$table.rows.length - 1;
			page=len % pageSize==0 ? len/pageSize : Math.floor(len/pageSize)+1;//根据记录条数，计算页数
			curPage=1;        //当前页
				direct=0;        //方向
				firstPage();
				displayPage();
		}
	function displayPage(){
		if(curPage <=1 && direct==-1){
			direct=0;
			layer.alert("已经是第一页了",info_showtime);
			return;
		} else if (curPage >= page && direct==1) {
			direct=0;
			layer.alert("已经是最后一页了",info_showtime);
			return ;
		}
		//lastPage = curPage;
		// 修复当len=1时，curPage计算得0的bug
		if (len > pageSize) {
			curPage = ((curPage + direct + len) % len);
		} else {
			curPage = 1;
		}
		document.getElementById("btn0").innerHTML="当前 " + curPage + "/" + page + " 页    每页 ";        // 显示当前多少页
		begin=(curPage-1)*pageSize ;// 起始记录号
		end = begin + 1*pageSize ;    // 末尾记录号
		if(end > len ) end=len;
		//var theTable=$("#warnlogdata-tbody");// document.getElementById("warnlogdata-tbody");
		for ( var i = 0; i<len; i++ ) {
			$table.rows[i].style.display = 'none';
		}
		for ( var i = begin; i<end; i++ ) {
			$table.rows[i].style.display = '';
		}
		/*$table.find("tr").hide();    // 首先，设置这行为隐藏
		$table.find("tr").each(function(i){    // 然后，通过条件判断决定本行是否恢复显示
			if((i>=begin && i<=end) )//显示begin<=x<=end的记录
				$(this).show();
		});*/

		}

		$(document).on("click",".check_box",function(event){
		event.stopPropagation();//阻止事件冒泡，防止触发li的点击事件
		//勾选的项
		var $selectTextDom=$(this).parent().parent().parent("ul").siblings("label").children(".select_text");
		//勾选项的值
		//var $selectValDom=$(this).parent().parent().parent("ul").siblings(".select_val");
		//是否有选择项了
		var isSelected=$selectTextDom[0].getAttribute("data-is-select");
		var selectText="";//文本值，用于显示
		//var selectVal=$selectValDom.val();//实际值，会提交到后台的
		var selected_text=$(this).siblings("span").text();//当次勾选的文本值
		var selected_val=$(this).val();//当次勾选的实际值
		//判断是否选择过
		if(isSelected=="true"){
			selectText=$selectTextDom.val();
		}
		if(selectText!=""){
			if(selectText.indexOf(selected_text)>=0){//判断是否已经勾选过
				selectText=selectText.replace(selected_text,"").replace(";;",";");//替换掉
				//selectVal=selectVal.replace(selected_val,"").replace(",,",",");//替换掉
				//判断最后一个字符是否是逗号
				if(selectText.charAt(selectText.length - 1)==";"){
					//去除末尾逗号
					selectText=selectText.substring(0,selectText.length - 1);
					//selectVal=selectVal.substring(0,selectVal.length - 1);
				}
				//判断第一个字符是否是逗号，是的话去掉。
				if(selectText.charAt(0)==";"){
					selectText=selectText.substring(1);
				}
			}else{
				selectText+=";"+selected_text;
				//selectVal+=","+selected_val;
			}
		}else{
			selectText=selected_text;
			//selectVal=selected_val;
		}
		$selectTextDom.val(selectText);
		//$selectValDom.val(selectVal);
		if(selectText==""){
			$selectTextDom.text("请选择");
			$selectTextDom[0].setAttribute("data-is-select","false");
		}else{
			$selectTextDom[0].setAttribute("data-is-select","true");
		}
		var i_sel=$('input[name="timeselect"]:checked').val();//20200403添加筛选条件改变后自动刷新列表
		switch(i_sel*1){
			case 0:	case 1:	case 2:	case 3:	case 4:
				gethistorydata(sessionStorage.SensorId,catalog,name,sessionStorage.kssj,sessionStorage.jssj);
				break;
			case 5:
				showrealworning();
				break;
		}
	})
	</script>
</body>
</html>