<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<link rel="stylesheet" href="css/bootstrap.min.css" />
	<link rel="stylesheet" href="css/electricroommonitoring.css"/>
	<title>状态图形</title>
	<script  type="text/javascript" src="js/jquery-3.3.1.js"></script>
	<script  type="text/javascript" src="js/jquery.base64.js"></script>
	<script  type="text/javascript" src="js/config.js"></script>
	<script  type="text/javascript" src="js/layer/layer.js"></script>
	<script  type="text/javascript" src="js/drawmaps.js"></script>
	<script  type="text/javascript" src="js/function.js"></script>
	<style type="text/css"></style>
</head>
<body >
	<div>
		<div id="head_map">
			<div class="pagecard"  style="text-align: center;font-size:20px;font-style:normal;display:none;"><b>站示意图<!--onclick="getrealsbydataid()"--></b></div>
			<div class="rowlay" id="refrsh-binarys" ><b>
					图形列表：</b>
				<select id="txlb" onchange="getbinary()">
				</select><a href="javascript:void(0)"><span class="glyphicon glyphicon-refresh" onclick="refreshbinary()"></span></a>
				<!-- 起止时间:
				<input type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})"  id="kssj_history" style="width:190px;font-size:16px;height: 30px;"></input>至
				<input type="text" onClick="WdatePicker({el:this,dateFmt:'yyyy-MM-dd HH:mm:ss'})"  id="jssj_history" style="width:190px;font-size:16px;height: 30px;" ></input>
				<input class="button" type="button" id="chaxun" value="查询" onclick="queryhistorydata()" style="font-size:16px;height: 35px;" ></input>-->
			</div>
		</div>
		<a id="mapmodule" style="color:red;position:absolute;top:7px;right:20px;text-align:right" href="javascript:void(0)" onclick="showmodule()" ></a>
		<div id="maprefresh" style="display:none" onclick="refresh()"></div><!--有告警时刷新图形显示-->
		<div id="mycanvasdiv" style="background-color:#cccccc;position: relative; text-align: center; overflow: auto;">
			<div align="center">
				<canvas id="mycanvas" align="center" width="900px" height="700px" style="background-color:#000;">
				</canvas>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		var j=0;
		var BinariesId=sessionStorage.txid;
		$(document).ready(function(){
			$.base64.utf8encode = true;
			if(sessionStorage.map_module==1){
				mapmodule.innerText="自动缩放";
			}else{
				mapmodule.innerText="原尺寸显示";
			}
			var mCanvas=document.getElementById("mycanvas");
			mCanvas.width=document.documentElement.clientWidth;
			mCanvas.height=document.documentElement.clientHeight-125;
			//GetGraphic();
			initpage();
			//refresh();
			if(typeof(Worker) !== "undefined") {//只在网络状态下可用，本地磁盘目录下不可用。
			if(typeof(w1) == "undefined") {
				w1 = new Worker("delay_worker.js");
			}
			var i=0;
			w1.onmessage = function(event) {
					//document.getElementById("result").innerHTML = event.data;
					i++
					if(i%10==0){
						refresh();
					}
				};
			} else {
				var t1 = window.setInterval("refresh();",10000);
			}
			});
		function initpage(){
			updatapcnav(2);
			sessionStorage.framepag="drawmap.html";
			var sel_sensor=document.getElementById("txlb");
			for (var i = 0; i < sel_sensor.length; i++) {
				sel_sensor.removeChild(sel_sensor.options[0]);
				sel_sensor.remove(0);
				sel_sensor.options[0] = null;
			}
			binaries=JSON.parse(localStorage.getItem("binaries"));
			if(binaries!=null){
				for(var i=0;i<binaries.length;i++){
					var op=document.createElement("option");
					op.setAttribute("value",binaries[i].id);
					op.innerHTML=binaries[i].name;
					sel_sensor.appendChild(op);
				}
			}else{
				BinariesId=-1;
			}
			setSelectOption_txlb("txlb", BinariesId);
			if(binaries!=null&&BinariesId==-1){
				var opts=sel_sensor.getElementsByTagName("option");
				//opts[0].selected=true;
				BinariesId=opts[0].value;
				//GetBinary();
			}
			/*document.getElementById('txlb').addEventListener('change',function(){
				//var txlb= document.getElementById("txlb");
				sessionStorage.BinariesId=this.value;
				//alert("当前选项是:"+this.value);
				GetBinary();
				j++;
			 },false);
			 j=0;*/               //
			//queryhistorydata(); 
			GetBinary(BinariesId);
		}
	function setSelectOption_txlb(objid, sensor) {
		var sel = document.getElementById(objid);
		var options = sel.options;
		for (var i = 0; i < options.length; i++) {
			if (options[i].value == sensor) {
				options[i].defaultSelected = true;
				options[i].selected = true;
				break;
			}
		}
		if(options.length<=0){
			BinariesId=-1;
		}else if(i>=options.length){
			BinariesId=options[0].value;
			sessionStorage.txid=BinariesId;
		}
	}
		function refresh(){
			var graphic = JSON.parse(sessionStorage.contents);
			drawmap(graphic);
		}
		function refreshbinary(){
			window.parent.GetBinariesByType("NodeGraphic",sessionStorage.nodeId);
		}
		function showmodule(){
			var mapmodule=document.getElementById("mapmodule");
			if(mapmodule.innerText=="原尺寸显示"){
				sessionStorage.map_module=1;
				mapmodule.innerText="自动缩放";
			}else{
				sessionStorage.map_module=0;
				mapmodule.innerText="原尺寸显示";
			}
			refresh();
		}
		window.onresize=window.onscroll=refresh;
		function decoderealdata(){
		}
		function getbinary(){
			var txlb= document.getElementById("txlb");
			BinariesId=txlb.value;
			sessionStorage.txid=BinariesId;//保存图形id
			GetBinary(BinariesId);
		}
		</script>
</body>
</html>