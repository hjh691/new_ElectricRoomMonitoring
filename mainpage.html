<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<link rel="shortcut icon" href="#" /> <!-- 消除GET http://localhost:8080/favicon.ico 404 (Not Found) 错误提示-->
	<link rel="stylesheet" href="css/bootstrap.min.css" />
	<link rel="stylesheet" href="css/bootstrap-treeview.min.css" />
	<link rel="stylesheet" href="css/jquery-ui.css" /> 
	<link rel="stylesheet" href="css/electricroommonitoring.css" />
	<title>智能变电站辅助系统综合监测云平台</title>
	<script type="text/javascript" src="js/jquery-3.3.1.js"></script>
	<script  type="text/javascript" src="js/jquery-ui.js"></script>
	<script src="js/bootstrap.js"></script>
	<script type="text/javascript" src="js/config.js"></script>
	<script type="text/javascript" src="js/layer/layer.js"></script>
	<script type="text/javascript" src="js/cvi_busy_lib.js"></script>
	<script type="text/javascript" src="js/bootstrap-treeview.min.js"></script>
	<script type="text/javascript" src="js/function.js"></script>
	<style>
		.aside {
			height: 98%;
			width: 15%;
			position: relative;
			float:left;
			background:rgba(8, 177, 106, 0.3);/* #243747;*/
			transition: width .5s;
		}
		.aside-hide {
			height: 98%;
			width: 20px;
			position: relative;
			float:left;	
			background :rgba(8, 177, 106, 0.3);/* #243747;*/
			transition: width .5s;
		}
		.butn {
			border: 0;
			background: rgba(8, 177, 106, 0);/* #243747;*/
			color: #0f0f0f;
			position: absolute;
			top: 0;
			right: 4px;/*border-radius: 5px;*/
			height: 20px;
			cursor: pointer;
		}
	</style>
</head>
<body >
	<!--<div id="container" onmousemove="div_mousemove();"  style="background:rgba(250,0,0,0);width:100%;height:100%;position:absolute;"></div>
	onload="initIndex()""showusername()"<script  type="text/javascript" src="js/layer/layer.js"></script>onresize="resizeFresh()"-->
	<div class="header" id="header" >
		<div class="topbar" id="topbar">
			<div id="app_name"><i></i></div>
			<span id="img_yonghu" >
				<!--No.2登录用户名显示/未登录-->
				<img src="res/gif_head_48x48.gif" onclick="show3D()" width="20px" height="20px">
			</span>
			<!--end No.2-->
			<span id="yhname" style="position:relative;float:left;left:50px;color:white;font-size:12px;"><!--pageindex:20-->
				<!--No.1登录用户名显示/未登录-->
				未登录
			</span>
			<!--end No.1value="系统设置"-->
			<span id="yhout" ><a
					href="javascript:void(0)" style="color:white;">[登录]</a></span>
			<input id="nav11" type="button" class="topbar-bigbutton" value="联系我们"
				style="background:url(res/home.jpg) no-repeat center top;"
				onclick="showcontactus()"/><!--pageindex:300-->
			<input id="nav12" type="button" class="topbar-bigbutton" value="APP下载"
				style="background:url(res/chilun.jpg) no-repeat center top;" onclick="showdownload()"/><!--pageindex:200-->
			<!--<input type="button"  class="topbar-bigbutton" value="数据浏览" style="background:url(res/sanse.jpg) no-repeat center top;margin-top:10px;"></input>-->
			<input id="nav13" type="button" class="topbar-bigbutton" value="操作指南"
				style="background:url(res/bar.jpg) no-repeat center top;" onclick="showhelp()"/><!--pageindex:100-->
		</div>
		<hr style="display:none" />
	</div>
	<!--header-->
	<!--  内容  -->
	<div id="chuangti" >
		<!--左侧站名列表 <h4 id="head_list_name" align="left"  >变电站:</h4> style="display: none;"-->
		<aside class="aside" id="aside">
			<button class="butn" id="showaside" onclick="list()"><<</button>
			<div class="leftmenu" id="leftmenu" >
				
				<div class="tree " id="tree" style="overflow-x:auto;">
				</div>
				<div class="tree1 " id="tree_chi" >
				</div>
			</div>
		</aside>
		<div id="content" style="overflow: hidden;">
			<!-- 导航栏 -->
			<nav role="navigation" class="navbar-static-top"><!--class="navbar navbar-default navbar-fixed-top" role="navigation"border: solid rgba(0, 101, 105, 1) 1px;-->
			<div class="navigation" >
				<div class="row-navigation ">
					<ul class="pc-nav navbar-right" style="background-color: rgba(8, 177, 106, 0.2) ; margin-right: 0;border: solid  rgba(8, 177, 106, 0.5) 2px;border-radius: 10px;height: 40px;">
						<li><a id="nav1" href="javascript:void(0)" onclick="inittotalpage()" >信息总览</a></li><!--pageindex:0-->
						<li><a id="nav2" href="javascript:void(0)" onclick="initdrawing()" title="显示系统状态图">状态图</a></li><!--pageindex:1-->
						<li id="li_realdata"><a id="nav3" href="javascript:void(0)" onclick="initrealdata()" title="实时数据列表">实时数据</a></li><!--pageindex:2-->
						<li id="li_realstate" style="display: none;"><a id="nav14" href="javascript:void(0)" onclick="initrealstate()" title="动环实时状态">实时状态</a></li><!--pageindex:10-->
						<li id="li_preview" style="display: none;"><a id="nav4" href="javascript:void(0)" onclick="showpreview()" title="视频实时预览">实时预览</a></li><!--pageindex:8-->
						<li id="li_historydata"><a id="nav5" href="javascript:void(0)" onclick="loadstations_historydata()" title="历史数据变化趋势">历史数据</a></li><!--pageindex:3-->
						<li id="li_historystate" style="display: none;"><a id="nav15" href="javascript:void(0)" onclick="inithistorystate()" title="历史数据变化趋势">历史数据</a></li><!--pageindex:11-->
						<li id="li_replay" style="display: none;"><a id="nav6" href="javascript:void(0)" >视频回放</a></li><!--pageindex:9-->
						<li id="li_historychart"><a id="nav7" href="javascript:void(0)" onclick="loadstations_chart()" title="多点变化趋势比较">趋势对比</a></li><!--pageindex:4-->
						<li id="li_warnlog" ><a id="nav8" href="javascript:void(0)" onclick="loadstations_warnlog()" title="告警信息查询">告警信息</a></li><!--pageindex:5-->
						<li id="li_stationwarnlog" style="display: none;"><a id="nav16" href="javascript:void(0)" onclick="loadstations_warnlog()" title="告警查询">告警信息</a></li><!--pageindex:16-->
						<li><a id="nav9" href="javascript:void(0)" onclick="showdevice()" title="所有设备信息列表">设备信息</a></li><!--pageindex:6-->
						<li><a id="nav10" href="javascript:void(0)" onclick="showpage(0)" >系统设置</a></li><!--pageindex:7-->
						<li id="clickaudio" style="float:right;font-size:16px;display: none;"><a href="javascript:void(0)" style="color: red;" onclick="showdailog()">开启告警声音</a></li>
					</ul>
				</div>
			</div>
			</nav>
			<!--<div id="temp1-1" onmousemove="mouseMove;" style="background:rgba(250,0,0,0);width:100%;height:94%;position:absolute;"></div>style="z-index:-1"-->
			<div class="mainarea" id="mainarea" >
				<iframe name="iframe_main" id="iframe_main" onmousemove="mouseMove;" allowtransparency="true" allowfullscreen="true" style="width:100%;height:98%;" frameborder="0">
				</iframe>
				
				<table id="warningtable" style="display:none">
					<thead>
						<tr>
							<th>测量点编号</th>
							<th>测量点名称</th>
							<th>测量时间</th>
							<th>数值</th>
							<th>告警信息</th>
							<!--<th style="width:18px;border:0px solid black;"></th>-->
						</tr>
					</thead>
					<tbody id='realwarningdata-tbody'>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<div id="message_dialog" title="信息提示" style="font-size:20px;background-color:rgb(212, 211, 211);"></div><!--这里是一个jQuery的信息提示对话框HTML部分。内部可以再添加元素-->
	<!--底部公司版权 -->
	<div>
		<div class="navigation" id="footer" style="height:30px;float:bottom;bottom:0px;left:0px;right:0px;">	
			<div class="pc-footer" align="center"><!---->
					<label id="state_info" style="float:left;margin-left: 30px;color:rgb(240, 236, 9);"></label>
					<ul  align="center" style="margin:0 0;">
						<li ><a id="company_info" href="" target="_blank" style="color:white;"><img id="company_log" src="" width="20px" height="20px" ><lab id="company_name"></lab></a></li>
						<li style="color:white;" >Copyright: <lab id="copyright_time"></lab></li>
					</ul>
			</div>
		</div><!--<li ><a href="#" style="margin-left:500px" >实时告警窗口</a></li>display: none;-->
		<!--告警信息悬浮窗style="display:none"-->
		<div id="KeFuDiv" class="KeFuDiv" onmousedown="hidefudongdiv();" >
			<!--屏幕滚动设置 <div class="affiche_text" id="alert_info">style="display: none;"
			</div>
			 <marquee id="affiche" align="middle" behavior="scroll"  direction="left" height="50" width="500" hspace="100" vspace="50" loop="-1" scrollamount="10" scrolldelay="100" onMouseOut="this.start()" onMouseOver="this.stop()" ></marquee>-->
			<div id="alert_info" >
			</div>
		</div>
		<!--KeFuDiv end <embed height="0" width="0" src="">-->
		<div id="wrapSpk"><!--使用audio 谷歌核心浏览器不支持自动播放，采用iframe。如果iframe也不行，
			就只得使用人为干预，这时应使用audio标签，同时在function.js中的spack（）函数，修改成1#方案-->
			<!--<audio  id="spkAudio"  >   
				<source src="" type="audio/wav"/>
			</audio >-->
			<!--2# 使用iframe标签代替audio标签。-->
			<iframe id="spkAudio" allow="autoplay" style="display:none">
				<source src="" type="audio/wav"/>
			</iframe>
			<textarea id="chatData" style="width:300px;height:40px;display:none" onclick="spack()" ;>asd
			</textarea>
		</div>
		<div id="audio">
		</div>
	</div>
	<script>
		var windowHeight;
		var infotreedata = [], maps = [];
		var mnodes=[];
		var infotreeobj = new Object();
		var allsensors = null;
		var sensorsnode=null;
		var nodes = null, nodeid = -1;
		//sessionStorage.txid=-1;//20200228 初始化一次图形id
		sessionStorage.nodetype=1;
		var iframemain=$("#iframe_main");
		var multiselect = false;
		var tree2=false;
		//最后一次触发节点Id
		var lastSelectedNodeId = null;
		//最后一次触发时间
		var lastSelectTime = null;
		var dialog=null;
		var realdataid=-1;
		var loadlayer=null;
		var time=null;
		//滚动插件实现，只用于横向滚动。
		(function ($) {
			$.fn.extend({
				
				roll: function (options) {
					var defaults = {
						speed: 1
					};
					var options = $.extend(defaults, options);
					var speed = (document.all) ? options.speed : Math.max(1, options.speed - 1);
					if ($(this) == null) return;
					var $container = $(this);
					var $content = $("#alert_info");
					var init_left = $container.width();
					$content.css({ left: parseInt(init_left) + "px" });
					var This = this;
					time = setInterval(function () { This.move($container, $content, speed); }, 20); //setInterval会改变this指向，即使加了This=this，也要用匿名函数封装，这里调试了n久
					$container.bind("mouseover", function () {
						clearInterval(time);
					});
					$container.bind("mouseout", function () {
						time = setInterval(function () { This.move($container, $content, speed); }, 20);
					});
					return this;
				},
				move: function ($container, $content, speed) {
					var fdck = document.getElementById("KeFuDiv");
					if (fdck.style.display == "none") { 
						return }
					var container_width = $container.width();
					var content_width = $content.width();
					if (parseInt($content.css("left")) + content_width > 0) {
						$content.css({ left: parseInt($content.css("left")) - speed + "px" });
					}
					else {
						$content.css({ left: parseInt(container_width) + "px" });
						document.getElementById("alert_info").innerHTML="";
						fdck.style.display = "none";
						//clearInterval(time);
						//time=null;
						//window.speechSynthesis.cancel();
					}
				}
			});
		})(jQuery);
		$(document).ready(
			function () {
				try{
				$("#KeFuDiv").roll({ speed: 3 });//字幕滚动/**/
				//jquery信息框
				dialog=$("#message_dialog").dialog({
                    draggable:false,
                    resizable:false,
                    modal:false,
					autoOpen:false,
					hide:'explode',
                    buttons:{
                        "确认":function(){
                            $(this).dialog("close");

                        }
                    }
                });
                
				if (typeof (Worker) !== "undefined") {//定时器多任务
					if (typeof (w) == "undefined") {
						w = new Worker("delay_worker.js");
					}
					i = 0;
					w.onmessage = function (event) {//接收定时器返回的消息
						//document.getElementById("result").innerHTML = event.data;
						i++;
						//if ((i % 60 == 0)&&(sessionStorage.islogin=="true")) {//减少在没有连接时的通信次数和系统的信息提示框的显示
							//sendbeat();
							getrealdatabynodeid(realdataid);
							//GetBinariesByType("NodeGraphic",sessionStorage.nodeId);
						//}
						if((sessionStorage.islogin=="false")&&(i % 5==0)){
							LoginOrder(localStorage.username,sessionStorage.password,1);
						}
						if((sessionStorage.pageindex==1)&&(i % 15==0)){
							iframemain[0].contentWindow.getbinary();//刷新一次图形
						}
					};
				} else {
					var t1 = window.setInterval(getrealdatabynodeid(realdataid), 60000);//getrealsbydataid
				}
				window.setInterval("resetContent()", 200);
				refreshwindow();
				//initIndex();
				if(sessionStorage.kssj==undefined){
					sessionStorage.kssj = getCurrentDate(1) + " 00:00:00"; // //;
					sessionStorage.jssj = getCurrentDate(2); //"2012-09-05T08:00:00";//+ " 23:59:59" 听力
					sessionStorage.cxsj = getCurrentDate(2);
				}
				if (sessionStorage.islogin) {
					getNodes();
				} else {
					inittreeview();
				}
				$(".tab a:last").tab("show");
			}catch(err){
				showstateinfo(err.message.message,"mainpage/startpage")	
			}
		});
		//launchFullScreen(document.documentElement);//全屏显示 
		function launchFullScreen(element) {
			if(element.requestFullScreen) {
			element.requestFullScreen();
			} else if(element.mozRequestFullScreen) {
			element.mozRequestFullScreen();
			} else if(element.webkitRequestFullScreen) {
			element.webkitRequestFullScreen();
			}
		}
		function showloadlayer(){
			loadlayer = layer.load(0, {shade: false,time:5000});//
		}
		function closeloadlayer(){
			layer.close(loadlayer);
		}
		function refreshwindow() {//重画窗口，规定 尺寸,尤其是浮动窗口的位置
		try{	
			showloadlayer();
			if(!sessionStorage.framepage)
				sessionStorage.framepage = iframemain.attr('src');
			//if(sessionStorage.framepage.indexOf("video.html")>=0){
			//	return;
			//}
			//var bodyfrm = (document.compatMode.toLowerCase() == "css1compat") ? document.documentElement : document.body; physics
			//var fdheight =50;// document.getElementById("KeFuDiv").offsetHeight;
			//var fdwidth =500;// document.getElementById("KeFuDiv").offsetWidth;
			var main = document.getElementById("chuangti");
			//var header = document.getElementById("header");
			var menu = document.getElementById("aside");
			var content = document.getElementById("content");
			//var footer = document.getElementById("footer");
			//isfree="true";
			//获取窗口宽度
			if (window.innerWidth)
				winWidth = window.innerWidth;
			else if ((document.body) && (document.body.clientWidth))
				winWidth = document.body.clientWidth;
			//获取窗口高度
			if (window.innerHeight)
				winHeight = window.innerHeight;
			else if ((document.body) && (document.body.clientHeight))
				winHeight = document.body.clientHeight;
			//初始位置
			//var top = bodyfrm.scrollTop + bodyfrm.clientHeight - fdheight - 10;
			//document.getElementById("KeFuDiv").style.top = top + 'px';////document.getElementById("KeFuDiv").offsetHeight)-30;
			//var left = bodyfrm.scrollLeft + bodyfrm.clientWidth - fdwidth;//document.getElementById("KeFuDiv").offsetWidth)-17;;
			// (winHeight - document.getElementById("KeFuDiv").offsetHeight)-30 +"px";
			//document.getElementById("KeFuDiv").style.left = left + 'px';//(winWidth - 
			//document.getElementById("KeFuDiv").style.display="none";
			var m = (/MSIE [67]/.test(navigator.userAgent) && (event.type == "load")) ? 1 : 2;
			/*if (/MSIE [567]/.test(navigator.userAgent)) {
				var fwidth = main.offsetWidth;
				if(footer.style.borderWidth){
					fwidth -= m * footer.style.borderWidth.replace("px","");
				}
				footer.style.width = fwidth + "px";
			}*/
			var height = winHeight - main.offsetTop;//footer.offsetTop 
			if (main.style.borderWidth) {
				height -= m * main.style.borderWidth.replace("px", "");
			}
			if (height > 0) {
				main.style.height = height*1-30 + "px";
				var mheight = height;
				if (menu.style.borderWidth) {
					mheight -= m * menu.style.borderWidth.replace("px", "");
				}
				if (mheight > 0) {
					menu.style.height = mheight-30 + "px";
				}
				mheight = height;
				if (content.style.borderWidth) {
					mheight -= m * content.style.borderWidth.replace("px", "");
				}
				if (mheight > 0) {
					content.style.height = mheight-30 + "px";
				}
			}
			windowHeight=height;
			initIndex();//窗口尺寸变化时是否重画所有内容。
		}catch(err){
			showstateinfo(err.message,"mainpage/refreshwindow");
		}
		}
		
		window.onresize = window.onscroll = refreshwindow;//  
		function resetContent() {
			var bodyfrm = (document.compatMode.toLowerCase() == "css1compat") ? document.documentElement : document.body;
			var allw = bodyfrm.clientWidth;// - 10;
			var allh = bodyfrm.clientHeight ;//- 60;
			var adst = document.getElementById("KeFuDiv").style;
			var str_al_info=document.getElementById("alert_info").innerHTML;
			str_al_info=str_al_info.replace(/^\s+$/g,"");
			if (str_al_info.length > 0) {
				adst.display = 'block';
				adst.top = (bodyfrm.scrollTop + bodyfrm.clientHeight - 50) + "px";
				adst.left = (bodyfrm.scrollLeft + bodyfrm.clientWidth - 500) + "px";
			}
			else {
				adst.display = 'none';
			}
		}
		function initIndex() {
			showusername();
			$('#app_name').html('<i>' + jfjk_base_config.app_name+ '</i>');
			if(localStorage.log_src){
				jfjk_base_config.log_src=localStorage.log_src;
			}
			$('#company_log').attr('src',jfjk_base_config.log_src);
			$('#company_info').attr('href',jfjk_base_config.company_url);
			$("#company_name").html(jfjk_base_config.company);
			$("#copyright_time").html("  "+jfjk_base_config.date);//+"  "+jfjk_base_config.ver_id 
			//sessionStorage.kssj = getCurrentDate(1) + " 00:00:00"; // //;
			//sessionStorage.jssj = getCurrentDate(2); //"2012-09-05T08:00:00";//+ " 23:59:59"
			//sessionStorage.cxsj = getCurrentDate(2);
			//sessionStorage.pageindex = 1;
			//getgraphics();
			//document.getElementById("iframe_main").src = 'page1.html';
			
			if (sessionStorage.framepage=="undefined" || sessionStorage.framepage == "" || (typeof sessionStorage.framepage)=="undefined" ) {
				iframemain.attr('src','newrealdata.html');//infototal.html
				sessionStorage.framepage=iframemain.attr('src');
				sessionStorage.pageindex = 2;
			} else {
				//iframemain.attr('src',sessionStorage.framepage);
				iframemain[0].src=sessionStorage.framepage;
			}
			/*if (sessionStorage.islogin) {
				getNodes();
			} else {
				inittreeview();
			}*/
			if(localStorage.showLeftMenu && localStorage.showLeftMenu=="true")
				showLeftMenu(localStorage.showLeftMenu)	
			else showLeftMenu(false);
		}
		//开启告警声音
		function showdailog(){
			var sound=document.getElementById("clickaudio");
			sound.style.display="none";
			Alert("告警声音已开启",500);
			showstateinfo("告警声音开启");
		}
		//初始化目录树
		function inittreeview(anodes) {
			try{
			var sensorstree=$("#tree");
			//obj.nodes=(JSON.parse( node));
			//tree[1]=obj;
			mnodes = [];
			if (anodes == null) {
				mnodes = buildnode();
			} else {
				mnodes = anodes;
			}
			sensorstree.treeview({
				data: mnodes,    // 数据源
				showCheckbox: false,   //是否显示复选框
				highlightSelected: true,    //是否高亮选中
				nodeIcon: 'glyphicon glyphicon-user',    //节点上的图标 glyphicon-stats
				//nodeIcon: 'glyphicon glyphicon-lock',
				emptyIcon: '',    //没有子节点的节点图标
				enableLinks: false,//为true时，必须在节点属性给出href属性，否则可能发生不可预知的现象
				multiSelect: false,    //多选
				searchResultColor: "black",
				color: "#fff",//所有节点使用的默认前景色，这个颜色会被节点数据上的Color属性覆盖.        String
				backColor: "rgba(0, 101, 105, 1);", //所有节点使用的默认背景色，这个颜色会被节点数据上的backColor属性覆盖.     String
				showBorder: false,
				//borderColor: "#000000", //边框颜色。如果不想要可见的边框，则可以设置showBorder为false。        String
				//nodeIcon: "glyphicon glyphicon-stop", //所有节点的默认图标
				//checkedIcon: "glyphicon glyphicon-check", //节点被选中时显示的图标         String
				//collapseIcon: "glyphicon glyphicon-minus", //节点被折叠时显示的图标        String
				//expandIcon: "glyphicon glyphicon-plus", //节点展开时显示的图标        String
				//emptyIcon: "glyphicon", //当节点没有子节点的时候显示的图标              String
				//enableLinks: false, //是否将节点文本呈现为超链接。前提是在每个节点基础上，必须在数据结构中提供href值。        Boolean
				//highlightSearchResults: true, //是否高亮显示被选中的节点        Boolean
				//levels: 2, //设置整棵树的层级数  Integer
				//multiSelect: false, //是否可以同时选择多个节点      Boolean
				onhoverColor: "#3075a5", //光标停在节点上激活的默认背景色      String
				//selectedIcon: "glyphicon glyphicon-stop", //节点被选中时显示的图标     String
				//searchResultBackColor: "", //当节点被选中时的背景色
				//searchResultColor: "", //当节点被选中时的前景色
				//selectedBackColor: "", //当节点被选中时的背景色
				//selectedColor: "#FFFFFF", //当节点被选中时的前景色
				//showBorder: true, //是否在节点周围显示边框 btn-praty
				//showCheckbox: false, //是否在节点上显示复选框
				//showIcon: true, //是否显示节点图标
				//showTags: false, //是否显示每个节点右侧的标记。前提是这个标记必须在每个节点基础上提供数据结构中的值。
				//uncheckedIcon: "glyphicon glyphicon-unchecked", //未选中的复选框时显示的图标，可以与showCheckbox一起使用
				//onNodeChecked: function (event,data) {
				//	console.log("nodeId = "+data.nodeId);
				//	console.log("id = "+data.id);
				//},
				onNodeSelected: function (event, data) {//目录树节点选中事件--提取对应id，获取旗下标签
					var selectnode=sensorstree.treeview('getSelected');
					sensorstree.treeview('collapseAll')//,nodeid);//关闭展开 注释掉用于不主动关闭展开的节点
					sessionStorage.selNodeId = data.nodeId;
					localStorage.setItem("sensor_tree",null);
					//sessionStorage.selectText="";
					if(data.Catalog){//Catalog为空标书为非叶子节点（最终节点）
						if((data.Catalog).indexOf(sysnames[0])>=0){//对系统名称的匹配改完全相等为包含，可以匹配更多的同义名称
							sessionStorage.nodetype=0;//全局变量，用于存储节点类型，来区分要显示的内容（导航栏标题，iframe对应的html页，历史数据变化趋势的取值等）
							maps = [];
							infotreedata = [];
							infotreeobj = {};
							infotreeobj.id = data.id;
							infotreeobj.name = data.text;
							infotreeobj.children = [];
							infotreeobj.level = data.level;
							//infotreeobj.isload="false";
							if ((data.hasOwnProperty("nodes")) && (data.nodes.length > 0) && (data.level < (Levels_of_treeview-1))) {
								infotreeobj.value = data.nodes.length;
								infotreeobj.children = decode(data.nodes);
							} else {
								infotreeobj.value = 0;
							}
							infotreedata.push(infotreeobj);
							if (data.nodeId != nodeid && data.level <= Levels_of_treeview-1) {
								localStorage.setItem("sensors", null);
								sessionStorage.nodeId = data.id;
								if(!data.hasOwnProperty("nodes"))
								GetBinariesByType("NodeGraphic", sessionStorage.nodeId);//将GetBinariesByType与GetSensorsByNode顺序颠倒，以便执行refreshiframe
								GetSensorsByNode(data.id);
								sessionStorage.t_p = 0;
								nodeid = data.nodeId;
							}
							//document.getElementById("iframe_main").src="http://192.168.10.164";
							updatanav(sessionStorage.nodetype);
						}else if ((data.Catalog.indexOf(sysnames[1])>=0 )||(data.Catalog.indexOf(sysnames[2])>=0)||(data.Catalog.indexOf(sysnames[3])>=0)) {
							sessionStorage.nodetype=1;
							maps = [];
							infotreedata = [];
							infotreeobj = {};
							infotreeobj.id = data.id;
							infotreeobj.name = data.text;
							infotreeobj.children = [];
							infotreeobj.level = data.level;
							//infotreeobj.isload="false";
							if ((data.hasOwnProperty("nodes")) && (data.nodes.length > 0) && (data.level < (Levels_of_treeview-1))) {
								infotreeobj.value = data.nodes.length;
								infotreeobj.children = decode(data.nodes);
							} else {
								infotreeobj.value = 0;
							}
							infotreedata.push(infotreeobj);
							if (data.nodeId != nodeid && data.level <= (Levels_of_treeview-1)) {
								localStorage.setItem("sensors", null);
								sessionStorage.nodeId = data.id;
								if(!data.hasOwnProperty("nodes"))
								GetBinariesByType("NodeGraphic", sessionStorage.nodeId);
								GetSensorsByNode(data.id);
								sessionStorage.t_p = 0;
								nodeid = data.nodeId;
							}
							//iframe_main.window.num=0;
							updatanav(sessionStorage.nodetype);
						} else if((data.Catalog).indexOf(sysnames[4])>=0){//20200304
							sessionStorage.nodetype=2;
							//var p_node = getThe_level_nodeid(data,(Levels_of_treeview-1));
							if (data.nodeId != nodeid && data.level <= (Levels_of_treeview-1)) {
								localStorage.setItem("sensors", null);
								sessionStorage.nodeId = data.id;
								//sessionStorage.nodeId = p_node.id;
								if(!data.hasOwnProperty("nodes"))
								GetBinariesByType("NodeGraphic", sessionStorage.nodeId);
								GetSensorsByNode(sessionStorage.nodeId);
								nodeid = data.nodeId;
							}
							maps = [];
							infotreedata = [];
							infotreeobj = {};
							infotreeobj.id = data.id;
							infotreeobj.name = data.text;
							infotreeobj.level = data.level;
							//infotreeobj.value=0;
							infotreeobj.children = [];
							//infotreeobj.level=data.level;
							if ((data.hasOwnProperty("nodes")) && (data.nodes.length > 0)) {
								infotreeobj.value = data.nodes.length;
								var arr_node = buildsensor1(data.nodes);
								infotreeobj.value = arr_node.length;
								infotreeobj.children = decode(data.nodes);
							} else {
								infotreeobj.value = 0;
							}
							infotreedata.push(infotreeobj);
							updatanav(sessionStorage.nodetype);
						}
					} else if((data.Catalog).indexOf(sysnames[5])>=0){ //综合

					}//else if((data.Catalog).indexOf(sysnames[6])>=0){//开关柜

					//}
					else {//其他或默认
						//infotreeobj.value=0;
						infotreeobj.children = [];
						//infotreeobj.level=data.level;
						if ((data.hasOwnProperty("nodes")) && (data.nodes.length > 0)) {
							infotreeobj.value = data.nodes.length;
							var arr_node = buildsensor1(data.nodes);
							infotreeobj.value = arr_node.length;
							infotreeobj.children = decode(data.nodes);
						} else {
							infotreeobj.value = 0;
						}
						isessionStorage.nodetype=-1;
						updatanav(sessionStorage.nodetype);
						//updatanav(sessionStorage.nodetype);
						//sessionStorage.SensorId = data.id;
						//var p_node = getThe_level_nodeid(data, (Levels_of_treeview-1));
						if (data.nodeId != nodeid && data.level <= (Levels_of_treeview-1)) {
							localStorage.setItem("sensors", null);
							sessionStorage.nodeId = data.id;
							//sessionStorage.nodeId = p_node.id;
							//if(!data.hasOwnProperty("nodes"))
							GetBinariesByType("NodeGraphic", sessionStorage.nodeId);
							GetSensorsByNode(sessionStorage.nodeId);
							nodeid = data.nodeId;
						}
						maps = [];
						infotreedata = [];
						infotreeobj = {};
						infotreeobj.id = data.id;
						infotreeobj.name = data.text;
						infotreeobj.level = data.level;
						nfotreedata.push(infotreeobj);
					}
					//for (var i = 0; i < data.level; i++) {//逐级展开所选节点的父节点。
					//	var p_node = getThe_level_nodeid(data, i);
					//	sensorstree.treeview('expandNode', [p_node.nodeId, { levels: 1, silent: true }]);
					//}
					//sensorstree.treeview('expandNode', [data.nodeId, { levels: 1, silent: true }]);
					sensorstree.treeview("revealNode",[data.nodeId, { levels: 1, silent: true }])
				},
				onSearchComplete:function(event, data) { 
					var firstSearchResult = sensorstree.find('ul').find('li[data-nodeid='+ sessionStorage.selNodeId +']');
					sensorstree.scrollTop(firstSearchResult[0].offsetTop);
				},
				/**方法
				 * checkAll(options);//选中所有树节点
				checkNode(node | nodeId, options);  //选中一个给定nodeId的树节点
				clearSearch();//清除查询结果
				collapseAll(options);//折叠所有树节点
				collapseNode(node | nodeId, options);//折叠一个给定nodeId的树节点和它的子节点
				disableAll(options);//禁用所有树节点
				disableNode(node | nodeId, options);//禁用一个给定nodeId的树节点
				enableAll(options);//激活所有树节点
				enableNode(node | nodeId, options);//激活给定nodeId的树节点
				expandAll(options);//展开所有节点
				expandNode(node | nodeId, options);//展开给定nodeId的树节点
				getCollapsed();//返回被折叠的树节点数组
				getDisabled();//返回被禁用的树节点数组
				getEnabled();//返回被激活的树节点数组  
				getExpanded();//返回被展开的树节点数组
				getNode(nodeId);//返回与给定节点id相匹配的单个节点对象。
				getParent(node | nodeId);//返回给定节点id的父节点
				getSelected();//返回被选定节点的数组。
				getSiblings(node | nodeId);//返回给定节点的兄弟节点数组
				getUnselected();//返回未选择节点的数组
				remove();//删除the tree view component.删除绑定的事件，内部附加的对象，并添加HTML元素。
				revealNode(node | nodeId, options);//显示给定的树节点，将树从节点扩展到根。
				search(pattern, options);//在树视图中搜索匹配给定字符串的节点，并在树中突出显示它们。返回匹配节点的数组。
				selectNode(node | nodeId, options);//选择一个给定的树节点
				toggleNodeChecked(node | nodeId, options);//Toggles a nodes checked state; checking if unchecked, unchecking if checked.
				toggleNodeDisabled(node | nodeId, options);//切换节点的禁用状态;
				toggleNodeExpanded(node | nodeId, options);//切换节点的展开与折叠状态
				toggleNodeSelected(node | nodeId, options);//切换节点的选择状态
				uncheckAll(options);//不选所有节点
				uncheckNode(node | nodeId, options);//不选给定nodeId的节点
				unselectNode(node | nodeId, options);//不选给定nodeId的节点
				事件：
				*nodeChecked (event, node) - 一个节点被checked.
				*nodeUnchecked (event, node) - 一个节点被unchecked.
				*nodeCollapsed (event, node) - 一个节点被折叠.
				*nodeDisabled (event, node) - 一个节点被禁用.
				*nodeEnabled (event, node) - 一个节点被启用.
				*nodeExpanded (event, node) - 一个节点被展开.
				*nodeSelected (event, node) - 一个节点被选择.
				*nodeUnselected (event, node) - 取消选择一个节点.
				*searchComplete (event, results) - 搜索完成之后触发.
				*searchCleared (event, results) - 搜索结果被清除之后触发.
				*/
			});
			sensorstree.treeview('collapseAll');//关闭展开
			if (sessionStorage.selNodeId == "" || sessionStorage.selNodeId == null) {
				sessionStorage.selNodeId = 0;//mnodes[0].text;//如果没有选择项，则选择第一项。
			}
			//var firstNode = $("#tree").treeview('search', [sessionStorage.selNodeId + "", { ignoreCase: false, exactMatch: false }]);//得到第一个节点//在页面尺寸变化时保持选项不变
			//if (firstNode[0].id != sessionStorage.nodeid) {
			//	nodeid = mnodes[0].id; sessionStorage.nodeid = firstNode[0].id;
			//} else {
			//保存nodeid，用于获取指定node的sensors。//lazy cozy crazy easy busy dizzy fantasy 
			//	nodeid = firstNode[0].nodeId;
			//}
			var firstNode = sensorstree.treeview("getNode", sessionStorage.selNodeId);
			sensorstree.treeview('expandNode', [firstNode, { levels: 2, silent: true }]);//展开第一个节点
			//for (var i = 0; i < firstNode.level; i++) {//逐级展开所选节点的父节点。
			//	var p_node = getThe_level_nodeid(firstNode, i);
			//	sensorstree.treeview('expandNode', [p_node.nodeId, { levels: 1, silent: true }]);
			//}
			//sensorstree.treeview('expandNode', [firstNode.nodeId, { levels: 1, silent: true }]);
			sensorstree.treeview("revealNode",[firstNode.nodeId, { levels: 1, silent: true }])//展开所选节点
			//$('#tree').treeview('expandNode', [ tree[0].id, { levels: 2, silent: true } ]);
			//$('#tree').treeview('selectNode', [firstNode, { silent: true }]);
			sensorstree.treeview("selectNode", firstNode);//将第一个节点设置为选中状态**
			sensorstree.treeview('search', [sessionStorage.selNodeId + "", { ignoreCase: false, exactMatch: false }]);
			//获取指定node的sensors
			//GetSensorsByNode(sessionStorage.nodeid);
			infotreedata = [];
			infotreeobj.id = firstNode.id;
			infotreeobj.name = firstNode.text;
			if (firstNode.hasOwnProperty("nodes")) {
				infotreeobj.value = firstNode.nodes.length;
			} else {
				infotreeobj.value = 0;
			}
			infotreeobj.children = [];
			infotreeobj.level = firstNode.level;
			//infotreeobj.isload="false";
			if ((firstNode.hasOwnProperty("nodes")) && (firstNode.nodes.length > 0) && (firstNode.level < 2)) {
				infotreeobj.children = decode(firstNode.nodes);
			}
			infotreedata.push(infotreeobj);
			maps = [];
			//localStorage.setItem("sensors", null);
			//localStorage.setItem("sensor_tree",null);
			//if(!firstNode.hasOwnProperty("nodes"))
			//GetSensorsByNode(infotreeobj.id);//获取指定节点下的标签信息
			//GetBinariesByType("NodeGraphic", infotreeobj.id);
			if(firstNode.Catalog=="视频监控"){
				sessionStorage.nodetype=0;
				updatanav(sessionStorage.nodetype);
			}else if(firstNode.Catalog=="机房监控"){
				sessionStorage.nodetype=2;
				updatanav(sessionStorage.nodetype);
			}else{updatanav(sessionStorage.nodetype);}
			//setTimeout(function(){if(sessionStorage.pageindex==0){
			//	document.getElementById("iframe_main").src="infototal.html";
			//}},3000);
			function getThe_level_nodeid(anode, alevel) {
				while (anode.level > alevel) {
					anode = (sensorstree.treeview("getParent", anode))
				}
				return anode;
			}
			}catch(err){
				showstateinfo(err.message,"mainpage/inittreeview");
			}
		}
		//更新导航栏信息（主要用于区分视频监控、机房监控与其他子系统的的操作信息
		function updatanav(type){
			switch(type*1){//使用变量后参数变为字符串型，需转换成数值型；或者在case语句中使用"0"来代替0。否则不匹配。
				case -1:
					document.getElementById("li_realdata").style.display="inline";
					document.getElementById("li_realdata").style.disabled="inline";
					document.getElementById("li_realstate").style.display="none";
					document.getElementById("li_historystate").style.display="none";
					document.getElementById("li_historydata").style.display="inline";
					document.getElementById("li_warnlog").style.display="inline"
					document.getElementById("li_historychart").style.display="inline";
					document.getElementById("li_preview").style.display="none";
					sessionStorage.pageindex=0;//显示信息总览页，有待协商////////////*************************************************
					break;
				case 0:
					document.getElementById("li_realdata").style.display="none"
					document.getElementById("li_historydata").style.display="none";
					document.getElementById("li_warnlog").style.display="none"
					document.getElementById("li_historychart").style.display="none";
					document.getElementById("li_realstate").style.display="none";
					document.getElementById("li_historystate").style.display="none";
					document.getElementById("li_preview").style.display="inline";
					if(sessionStorage.pageindex!=0&&sessionStorage.pageindex!=1&&sessionStorage.pageindex!=6&&sessionStorage.pageindex!=7
						&&sessionStorage.pageindex!=100&&sessionStorage.pageindex!=200&&sessionStorage.pageindex!=300){
						sessionStorage.pageindex=8;
					}
					break;
				case 1:
					document.getElementById("li_realdata").style.display="inline";
					document.getElementById("li_realdata").style.disabled="inline";
					document.getElementById("li_realstate").style.display="none";
					document.getElementById("li_historystate").style.display="none";
					document.getElementById("li_historydata").style.display="inline";
					document.getElementById("li_warnlog").style.display="inline"
					document.getElementById("li_historychart").style.display="inline";
					document.getElementById("li_preview").style.display="none";
					if((sessionStorage.pageindex==8)||(sessionStorage.pageindex==10)){
						sessionStorage.pageindex=2;
					}
					//if(sessionStorage.pageindex==11){
					//	sessionStorage.pageindex=3;
					//}
				break;
				case 2://20200304 add 机房监控下的导航栏的显示内容
					var li=document.getElementById("li_realdata");
					li.style.display="none";
					document.getElementById("li_realstate").style.display="inline";
					document.getElementById("li_historystate").style.display="none";
					document.getElementById("li_historydata").style.display="inline";
					document.getElementById("li_warnlog").style.display="inline"
					document.getElementById("li_historychart").style.display="none";
					document.getElementById("li_preview").style.display="none";
					if((sessionStorage.pageindex==8)||(sessionStorage.pageindex==2)){
						sessionStorage.pageindex=10;
					}
					if(sessionStorage.pageindex==4){
						sessionStorage.pageindex=3;
					}
				break;
				case 3:

				break;
				case 4:

				break;
			}
		}
		function showpage(pid){//调试用显示不同的页面，正常只有0值。
			//if(sessionStorage.pageindex!=7){
				updatapcnav(10);
				iframemain.attr('src','systeminfo.html');
				sessionStorage.pageindex=7;
			//}
		}
		
		function decode(adata) {
			var infotree = [];
			let data_len=adata.length;
			for (var i = 0; i < data_len; i++) {
				var tempobj = new Object();
				tempobj.name = adata[i].text;
				tempobj.id = adata[i].id
				tempobj.level = adata[i].level;
				if (adata[i].level < 2) {
					if ((adata[i].hasOwnProperty("nodes")) && adata[i].nodes.length > 0) {
						tempobj.value = adata[i].nodes.length;
						tempobj.children = [];
						tempobj.children = decode(adata[i].nodes);
					} else {
						tempobj.value = 0;
					}
				} else {
					tempobj.value = 0;
				}
				infotree.push(tempobj);
			}
			return infotree;
		}
		function decode_sensors(adata) {
			var infotree = [];
			var ishavechild = false;
			let data_nodes_len=adata.nodes.length;
			for (var i = 0; i < data_nodes_len; i++) {
				if ((adata.hasOwnProperty("nodes")) && adata.nodes.length > 0) {
					//adata=adata.nodes;
					var tempobj = new Object();
					tempobj.name = adata.text;
					tempobj.id = adata.id;
					tempobj.level = adata.level;
					tempobj.value = data_nodes_len;
					tempobj.children = [];
					ishavechild = true;
					//var tempobj=new Object();
					//if((adata[i].hasOwnProperty("nodes"))&&adata[i].nodes.length>0){
					tempobj.children = decode_sensors(adata.nodes);
					//}
				}
			}
			return infotree;
		}
		//获取所有节点信息
		function getNodes(){
			sendorder("GetNodes",function(getnodes){
				if(getnodes!=null){
					nodes=buildnode(getnodes,0);
					inittreeview(nodes);
					GetSensors();
				}
			});
		}
		function buildnode(data, level) {
			var tree = [];
			if (data == null || typeof(data) == "undefined") {
				//*for (i = 0; i <1; i++) {
					var anodes = new Object();
					anodes.text = "没有节点" ;
					anodes.id = i;
					anodes.Catalog="";
					anodes.nodes = [];
					anodes.icon = "url(res/lock.png)";
					//var node = '[{"text":"测温","id":' + ((i + 1) * 10) + ',"icon":"glyphicon glyphicon-user","Catalog":"测温"},{"text":"局部放电","id":' + ((i + 1) * 10 + 1) + '},{"text":"弧光保护","id":' + ((i + 1) * 10 + 2) + '},{"text":"视频监控","id":' + ((i + 1) * 10 + 3) + '},{"text":"机房监控","id":' + ((i + 1) * 10 + 4) + ',"nodes":[{"text":"门禁","id":543},{"text":"水浸","id":345}]}]';
					//anodes.nodes = (JSON.parse(node));
					//var lnode=new Object();
					tree.push(anodes);
				//}*/
				alert("该用户没有复合条件的节点数据,<br>请使用其他用户名称登录",info_showtime);
			} else {
				let data_len=data.length;
				for (var j = 0; j < data_len; j++) {
					var anodes = new Object();
					anodes.text = data[j].value.name;//+"[Id:"+data[j].value.id+"]";
					anodes.id = data[j].value.id;
					anodes.ParentId=data[j].value.parentId;
					anodes.Catalog = data[j].value.type;
					anodes.Config = data[j].value.config;
					anodes.Time = data[j].value.time;
					anodes.level = level;
					if (data[j].value.hasOwnProperty("nodeId")) {
						anodes.NodeId = data[j].value.nodeId;
					}
					var icon = 'glyphicon glyphicon-user';
					switch (data[j].value.name.toLowerCase()) {
						case "视频监控":
							icon = "glyphicon glyphicon-facetime-video";//
							break;
						case "测温":
							icon = "glyphicon glyphicon-adjust";//glyphicon glyphicon-tree-conifer glyphicon glyphicon-bullhorn
							break;
						case "烟感":
							icon = "glyphicon glyphicon-refresh";//glyphicon glyphicon-leaf  glyphicon glyphicon-tint  glyphicon glyphicon-flash
							break;
						case "局部放电":
							icon = "glyphicon glyphicon-flash";// 
							break;
						case "弧光保护":
							icon = "glyphicon glyphicon-bullhorn";//
							break;
						case "机房监控":
							icon = 'glyphicon glyphicon-inbox';//
							break;
						case "门禁":
							icon = 'glyphicon glyphicon-lock';//
							break;
						case "灯光":
							icon = 'glyphicon glyphicon-cog';
							break;
						case "红外":
							icon = 'glyphicon glyphicon-signal';
							break;
						case "动力":
							icon = 'glyphicon glyphicon-retweet';
							break;
						case "环境":
							icon = "glyphicon glyphicon-leaf";//
							break;
						case "水浸":
							icon = "glyphicon glyphicon-tint";//
					}
					if (level == 0) {
						icon = "glyphicon glyphicon-home"
					}
					anodes.icon = icon;
					//var chi_len = data[j].Children.length;
					if (data[j].children&&data[j].children.length != 0) {
						anodes.nodes = [];
						anodes.nodes = buildnode(data[j].children, level + 1)
					}
					tree.push(anodes);
				}
			}
			return tree;
		}
		function showdownload() {
			if(sessionStorage.pageindex!=200){
				iframemain.attr("src","app_download.html");
				sessionStorage.pageindex=200;
			}else{
				iframemain.attr("src","app_download.html");
			}
		}
		function showhelp() {
			if(sessionStorage.pageindex!=100){
				updatapcnav(13);
				iframemain.attr("src","help.html");
				sessionStorage.pageindex=100;
			}else{
				iframemain.attr("src","help.html");
			}
		}
		function showcontactus() {
			if(sessionStorage.pageindex!=300){
				iframemain.attr("src","ContactUs.html");
				sessionStorage.pageindex=300;
			}else{
				iframemain.attr("src","ContactUs.html");
			}
		}
		function showdevice(){
			if(sessionStorage.pageindex!=6){
				iframemain.attr("src","device.html");
				sessionStorage.pageindex=6;
			}else{
				iframemain.attr("src","device.html");
			}
		}
		function showpreview(){
			if(sessionStorage.pageindex!=8){
				sessionStorage.pageindex=8;
				iframemain.attr("src","video.html");
			}else{
				iframemain.attr("src","video.html");
			}
		}
		//获取指定节点的一次图形列表  //Fresh strawberries tastes good;
		function GetBinariesByType(atype, anodeid){
			sendorder("GetNodeGraphicsByNode?nodeId="+ anodeid,function(data){
				if(!jQuery.isEmptyObject(data)){//.Result
					obj_Binaries = data;//.Result;
					localStorage.setItem("binaries", JSON.stringify(obj_Binaries));
				} else {
					localStorage.setItem("binaries", null);
					sessionStorage.islogin = true;
				}
			});
		}
		//获取指定节点包含的标签信息
		function GetSensorsByNode(anodeid){//20200928 add
			try{
			sendorder("GetSensorsByNode?nodeId="+anodeid,function(result){
				if (!jQuery.isEmptyObject(result.sensors)) {
					localStorage.setItem("sensor_tree",JSON.stringify(result.sensors));
					var treeseneors=JSON.parse(localStorage.getItem("sensor_tree"))
					var treenode=buildnode_level2(treeseneors,0);
					inittreeview_level2(treenode);
					tree2=true;
					maps = [];
					allsensors = new Object();
					buildsensor2(allsensors, result.sensors, "");
					var sensors = buildsensor(result.sensors);//(JSON.parse(localStorage.getItem("sensors")));
					localStorage.setItem("sensors", JSON.stringify(sensors));
					if(!jQuery.isEmptyObject(result.typeConfigs)){
						var configs=new Object();
						configs=result.typeConfigs;
						localStorage.setItem("Configs",JSON.stringify(configs));
					}else{
						localStorage.setItem("Configs",null);
					}
					if(!jQuery.isEmptyObject(result.configs)){
						var config=new Object();
						config=result.configs;
						localStorage.setItem("Config",JSON.stringify(config));
					}else{
						localStorage.setItem("Config",null);
					}
				} else {
					tree2=false;
					localStorage.setItem("sensor_tree",null);
					var treeseneors=JSON.parse(localStorage.getItem("sensor_tree"))
					var treenode=buildnode_level2(treeseneors,0);
					inittreeview_level2(treenode);
					localStorage.setItem("sensors", null);
					if(!jQuery.isEmptyObject(result.typeConfigs)){
						var configs=new Object();
						configs=result.typeConfigs;
						localStorage.setItem("Configs",JSON.stringify(configs));
					}else{
						localStorage.setItem("Configs",null);
					}
					if(!jQuery.isEmptyObject(result.configs)){
						var config=new Object();
						config=result.configs;
						localStorage.setItem("Config",JSON.stringify(config));
					}else{
						localStorage.setItem("Config",null);
					}
					sessionStorage.SensorId=-1;//清除标签id，避免一些没有标签的节点借用保存的标签id形成错误的查询条件
				}
				refreshiframe();
				getrealdatabynodeid(realdataid);
			})
		}catch(err){
			showstateinfo(err.message,"mainpage/GetSensorsByNode");
		}
		}
		//刷新iframe所包含的页面内容
		function refreshiframe() {
			try{
			//var frame=document.getElementById("iframe_main");///
			switch (sessionStorage.pageindex) {
				case '0':
					//if((iframemain.attr('src')).indexOf("/infototal.html")<=0){
						iframemain.attr('src', "infototal.html");
					//}else{
					//	iframemain[0].contentWindow.initinfototal();
					//}
					break;
				case '1':
					if((iframemain.attr('src')).indexOf("/drawmap.html")<=0){
						iframemain.attr('src', "drawmap.html");
					}else{		
						iframemain[0].contentWindow.initpage();
					}
					break;
				case '2':
					if((iframemain.attr('src')).indexOf("/newrealdata.html")>0){
						iframemain[0].contentWindow.initrealdata();
					}else{
						iframemain.attr('src', "newrealdata.html");
					}
					break;
				case '3':
					if((iframemain.attr('src')).indexOf("/historydata.html")>0){
						iframemain[0].contentWindow.initpage();
					}else{
						iframemain.attr('src',"historydata.html");
					}
					break;
				case '4':
					if((iframemain.attr('src')).indexOf("chart.html")<=0){
						iframemain.attr('src',"chart.html");
					}else{
						iframemain[0].contentWindow.inithistorychart();
					}
					break;
				case '5':
					if((iframemain.attr('src')).indexOf("/warnlog.html")<=0){
						iframemain.attr('src',"warnlog.html");
					}else{
						iframemain[0].contentWindow.initwarnlog();
					}
					break;
				case "6":
					if((iframemain.attr('src')).indexOf("/device.html")>0){
						iframemain[0].contentWindow.initdevice();
					}else{
						iframemain.attr('src',"device.html");
					}
					break;
				case "7":
					if((iframemain.attr('src')).indexOf("systeminfo.html")>0){
						iframemain[0].contentWindow.initsysteminfo();
					}else{
						iframemain.attr('src',"systeminfo.html");
					}
					break;
				case "8":
					iframemain.attr('src',"video.html");
					break;
				case "9":
					iframemain.attr('src',"replay.html");
					break;
				case "10":
					iframemain.attr('src',"realstate.html");
					break;
				case "11":
					iframemain.attr('src',"historystate.html");
					break;
				case "20"://用户信息页面
					iframemain.attr("src","userprofile.html");
					break;
				//case "100":
					//frame.src="Help.html";
					//break;
				//case "200":
					//frame.src="app_download.html";
					//break;
				//case "300":
					//frame.src="ContactUs.html";
					//break;//添加注释.......
				default:
					iframemain.arrt("src","newrealdata.html");
			}
			sessionStorage.framepage=iframemain.attr('src');
		}catch(err){
			showstateinfo(err.message.message,"mainpage/refreshiframe");
		}
		}
		//获取所有的标签信息
		function GetSensors(){
			try{
			sendorder("GetSensors",function(result){
				if (!jQuery.isEmptyObject(result.sensors)) {
					//sessionStorage.setItem("sensors",JSON.stringify(buildsensor(data.Result.Sensors)));
					//sensorsnode=buildnode(data.Result.Sensors,0);//(JSON.parse(localStorage.getItem("sensors")));
					maps=[];
					//allsensors = new Object();
					//buildsensor2(allsensors, result.sensors, "");
					localStorage.setItem("allsensors",JSON.stringify(buildsensor(result.sensors)));
					//var sensors=(JSON.parse(localStorage.getItem("sensors")));
					//var localsensors=buildsensor(data.Result.Sensors);
					//updatanodetree();
					if(!jQuery.isEmptyObject(result.typeConfigs)){//20200428 add
						var configs=new Object();
						configs=result.typeConfigs;
						localStorage.setItem("allConfigs",JSON.stringify(configs));
					}
					if(!jQuery.isEmptyObject(result.configs)){//20200428 add
						var config=new Object();
						config=result.configs;
						localStorage.setItem("Config",JSON.stringify(config));
					}else{
						localStorage.setItem("Config",null);
					}
				}else {
					allsensors = null;
					//localStorage.setItem("allsensors",null);
				}
			});
		}catch(err){
			showstateinfo(err.message.message,"mainpage/GetSensors")
		}
		}
		/*function updatainfotree(treedata, tnodeid, tsensors) {//,tvalue
			if (treedata != null && treedata != undefined) {
				for (var j = 0; j < treedata.length; j++) {
					if (treedata[j].id == tnodeid) {
						if (!treedata[j].hasOwnProperty("nodes")) {
							treedata[j].nodes = [];
						}
						treedata[j].nodes.push(tsensors);
						//var sumnode=sumseneor(tsensors);
						return;
					}
					if ((treedata[j].hasOwnProperty("nodes")) && (treedata[j].nodes.length > 0) && (treedata[j].level < 2)) {
						updatainfotree(treedata[j].nodes, tnodeid, tsensors);//tvalue,
					}
				}
			}
		}
		function sumseneor(asensors) {
			if ((typeof(asensors) != "undefined") && (asensors != null)) {
				var map1 = new Object();
				for (var i = 0; i < asensors.length; i++) {
					if ((asensors[i] != null)) {
						var key = asensors[i].type;//Group;
						if (key == null || key == '' || key.trim() == '') {//空、空字符、空格都按空对待，提示未分组。
							key = "未分组";
						}
						if (map1.hasOwnProperty(key)) {
							map1[key]++
						} else {
							map1[key] = 1;//value++
						}
					}
				}
			}
			return map1;
		}*/
		function buildsensor1(aSensors) {
			if ((typeof(aSensors) != "undefined") && (aSensors != null)) {
				let sensors_len=aSensors.length;
				for (var j = 0; j < sensors_len; j++) {
					var anodes = new Object();
					anodes.name = aSensors[j].text;
					anodes.id = aSensors[j].id;
					anodes.Catalog = aSensors[j].type;
					anodes.Config = aSensors[j].config;
					anodes.Time = aSensors[j].time;
					maps.push(anodes);
					if ((aSensors[j].hasOwnProperty("nodes") && (aSensors[j].nodes.length > 0))) {
						buildsensor1(aSensors[j].nodes);
					}
				}
				var compare = function (obj1, obj2) {
					var val1 = obj1.Name;
					var val2 = obj2.Name;
					if (val1 < val2) {
						return -1;
					} else if (val1 > val2) {
						return 1;
					} else {
						return 0;
					}
				}
				return (maps.sort(compare));
			}
		}
		function buildsensor2(obj, aSensors, parentkey) {
			if ((typeof(aSensors) != "undefined") && (aSensors != null)) {
				let sensors_len=aSensors.length;
				for (var i = 0; i < sensors_len; i++) {
					var s = aSensors[i];
					if (s != null && !jQuery.isEmptyObject(s.value)) {
						var v = s.value
						var map = new Object();
						map.id = v.id;
						map.Value = v;
						var key = $.trim(parentkey);
						if (v.address && $.trim(v.address) != "") {
							//key = key ? key + "_" + v.address : v.address;
							key = key ? key + "." + v.address : v.address;
						}
						if ((!jQuery.isEmptyObject(s.children))) {
							buildsensor2(obj, s.children, key);
						}
						/*if (v.type && $.trim(v.type) != "") {
							key = key ? key + "_" + v.type : v.type;
						}*/
						obj[key.toLowerCase()] = map;
					}
				}
			}
		}
		function buildsensor(aSensors) {
			if ((typeof(aSensors) != "undefined") && (aSensors != null)) {
				let sensors_len=aSensors.length;
				for (var i = 0; i < sensors_len; i++) {
					if ((aSensors[i] != null) && (!jQuery.isEmptyObject(aSensors[i].value))) {
						var map = new Object();
						map.id = aSensors[i].value.id;
						map.Value = aSensors[i].value;
						maps.push(map);
					}
					if ((aSensors[i] != null) && (!jQuery.isEmptyObject(aSensors[i].children))) {
						buildsensor(aSensors[i].children);
					}
				}
				var compare = function (obj1, obj2) {
					var val1 = obj1.Value.name;
					var val2 = obj2.Value.name;
					if (val1 < val2) {
						return -1;
					} else if (val1 > val2) {
						return 1;
					} else {
						return 0;
					}
				}
				return (maps.sort(compare));
			}
		}
		function decoderealdata(obj_realdata) {
			try{
			var parentid=-100,parentname="";
			var sensorname = "",
				alerttime = "",
				alertinfo = "",
				alertvalue = "";
			var tbody = document.getElementById('realwarningdata-tbody');
			var tableLength = tbody.rows.length;
			//for (var int = 0; int < tableLength; int++) {
			//	tbody.deleteRow(0);
			//}
			//obj_realdata=JSON.parse(localStorage.getItem("realdata"));//考虑使用此方法去掉调用的参数，20200408修改。暂时不用。
			var sensors = allsensors;
			var sensors=JSON.parse(localStorage.getItem("allsensors"));
			var obj_data = new Object();
			var pt = 0;
			if (sensors != null) {
				var str_speech=str_alert = "告警:";
				var gaojing = document.getElementById("alert_info");
				if (gaojing == null) {
					gaojing = parent.window.document.getElementById("alert_info");
				}
				var fdck = document.getElementById("KeFuDiv");
				if (fdck == null) {
					fdck = parent.window.document.getElementById("KeFuDiv");
				}
				var speech = document.getElementById("chatData");
				if (speech == null) {
					speech = parent.window.document.getElementById("chatData");
				}
				if(sessionStorage.contents){
					var graphic = JSON.parse(sessionStorage.contents);
					var obj = []
					if(graphic){//刷新一次侧图形中的绑定数值
						graphic.forEach(function(g) {
							if ($.trim(g).length > 0) {
								g = JSON.parse(g);
								if (g && g._shape && g._shape.Binding && g._shape.Text) {
									/*var channel=(g._shape.Binding).substring(0,g._shape.Binding.lastIndexOf('_'));
									var datatype=(g._shape.Binding).substr(g._shape.Binding.lastIndexOf('_')+1);*/
									var datafolder='',dataname='',channel='',datatype='';
									if(g._shape.Binding.indexOf(":")!=-1){
										channel=(g._shape.Binding).substring(0,g._shape.Binding.indexOf(':'));
										datatype=(g._shape.Binding).substr(g._shape.Binding.indexOf(':')+1);
									}
									if(g._shape.Binding.indexOf("：")!=-1){
										channel=(g._shape.Binding).substring(0,g._shape.Binding.indexOf('：'));
										datatype=(g._shape.Binding).substr(g._shape.Binding.indexOf('：')+1);
									}
									if(datatype.lastIndexOf(".")==-1){
										datafolder="Default";
										dataname=datatype;
									}else{
										var datafolder=datatyep.substring(0,datatype.lastIndexOf("."));
										var dataname=datatype.substr(datatype.lastIndexOf("."));
									}
									if(allsensors)
									if(allsensors[channel]){
										var sid=allsensors[channel].id;
										if ((obj_realdata)&&(obj_realdata.length>0)) {
											let realdata_len=obj_realdata.length;
											for(var loop=0;loop<realdata_len;loop++){
												/*if(obj_realdata[loop].sensorId==sid && obj_realdata[loop].name.toLowerCase()==datatype.toLowerCase()){*/
												if(obj_realdata[loop].sensorId==sid && obj_realdata[loop].name.toLowerCase()==dataname.toLowerCase()
													&&(obj_realdata[loop].folder.toLowerCase()==datafolder.toLowerCase())){
													obj_data = (obj_realdata)[loop];////
													g._shape.Text =(obj_data.value*1).toFixed(Number_of_decimal);// + " " + sensors[g._shape.Binding].Value.Unit ;
													if(obj_data.message){
														g._shape.isError=true;
													}else{
														g._shape.isError=false;
													}
													break;
												}
										}
										}
									}
								}
								obj.push(JSON.stringify(g));
							}
						});
					}
					sessionStorage.setItem("contents",JSON.stringify(obj))
				}
				let sersors_len=sensors.length;
				for (var i = 0; i < sersors_len; i++) {
					var sid = sensors[i].id + "";
					var nid=sensors[i].Value.nodeId;
					if((sensors[i].Value.parentId!="-1")&&(sensors[i].Value.parentId!=parentid)){
						parentid=sensors[i].Value.parentId;
						for(var j=0;j<sersors_len;j++){
							if(sensors[j].id==parentid){
								parentname=sensors[j].Value.name+"_";
								break;
							}
						}
					}
					if ((obj_realdata)&&(obj_realdata.length>0)) {
						let obj_length=obj_realdata.length;
						for(var loop=0;loop<obj_length;loop++){
						if(obj_realdata[loop].sensorId==sid){
							obj_data = obj_realdata[loop];////
							var rows=tbody.rows;
							var trs = tbody.getElementsByTagName("tr");
							let rowlength=rows.length;
							var msg=obj_data.message;
							//let ishave=false;
							for(var k=0;k<rowlength;k++){
								if(rows[k].cells[0].outerText==(sid+"")){
									//var msg = obj_data.message;
									if (!msg){// == null || msg == "" || typeof(msg) == "undefined" || msg.trim() == ""){//在列表中，但目前告警已取消则从列表中删除告警内容。
										if(pt>0)pt--;
										tbody.deleteRow(k);
										//ishave=true;
										break;
									}else{
										//if(rows[k].cells[3].outerText==(obj_data.value *1).toFixed(Number_of_decimal)){
											let jiange=GetDateDiff(rows[k].cells[2].outerText,((obj_data.time).replace(/T/g," ")).substring(0,19),"minute")
											if(jiange<10){
											//rows[k].cells[2].innerHTML=((obj_data.time).replace(/T/g," ")).substring(0,19);
											rows[k].cells[3].innerHTML=(obj_data.value *1).toFixed(Number_of_decimal);
											break;
										}else{
											tbody.deleteRow(k);
											showgaojing();
											//rows[k].cells[2].innerHTML=((obj_data.time).replace(/T/g," ")).substring(0,19);
											//rows[k].cells[3].innerHTML=(obj_data.value *1).toFixed(Number_of_decimal);
											//ishave=true;
											break;
										}
									} 
								}
							}
							//var msg = obj_data.message;
							if (!msg){// == null || msg == "" || typeof(msg) == "undefined" || msg.trim() == "") {//ishave ||
								continue;
							}
							if(k>=rows.length){//不在告警信息列表中则为新的告警，则进行添加。
								showgaojing();
							}
						}
					}
				}
				}
				var fdck = document.getElementById("KeFuDiv");
				if (pt > 0) {
					
					if(fdck.style.display=="block"){
						str_alert=gaojing.outerText+str_alert;
					}
					gaojing.innerHTML = "<pre  style='vertical-align:center;background-color: rgba(255,255,0,0);'>" + str_alert + "</pre>";
					//fdck.style.display="block";
					//resetContent();
					//speech.innerHTML =str_speech;// str_alert;//str_speech;
					//speech.click();
					playVoices(str_speech);
					//fdck.style.display = "block";
				} else {
					if(fdck.style.display!="block"){
						gaojing.innerText = "";
						speech.innerHTML = "";
					}
					//fdck.style.display = "none";
				}
			}/*else{
			layer.alert("没有符合条件的数据");
		}*/
			//tbody.rows[t_pt].scrollIntoView();
			//refreshData();
			function showgaojing(){//将告警形象添加到实时告警列表，并添加告警信息到告警信息字符串中供浮动窗口显示。
				var alert_sys_name=getsysname(mnodes,nid);//站和子系统名称
				alerttime = ((obj_data.time).replace(/T/g," ")).substring(0,19).substr(11);
				alertinfo = msg;
				alertvalue = parseFloat(obj_data.value).toFixed(Number_of_decimal);
				sname =parentname+ sensors[i].Value.name;
				var xs = 1;//sensors[i].Value.Factor;  数据结构修改，value为已经乘过系数的数值，svalue为未乘以系统的原始值 
				var type_td = getname(sensors[i].Value.type);//Catalog
				//添加数据列表项
				var tr = document.createElement('tr');
				tr.setAttribute("onlclick","tableclick(this)");
				var tdename = document.createElement('td');
				var tdid = document.createElement('td');
				var tdtype = document.createElement('td');
				var tdtime = document.createElement('td');
				var tdvalue = document.createElement('td');
				//var tdvalue2 = document.createElement('td');
				//var tdhistory = document.createElement('td');
				//var tdwarnlog = document.createElement('td');
				var tdmessage = document.createElement('td');
				tdename.innerHTML = sname;
				tdid.innerHTML = sid;
				tdid.style.cssText="display:none";
				tdtype.innerHTML = type_td;
				tdtype.style.cssText = "display:none";
				tdtime.innerHTML = ((obj_data.time).replace(/T/g," ")).substring(0,19); //jsonObject[i].color;
				tdvalue.innerHTML = (obj_data.value * xs).toFixed(Number_of_decimal);
				//tdvalue2.innerHTML = (obj_data[0].Value*xs/1.5).toFixed(Number_of_decimal);
				//tdhistory.setAttribute('backgroundColor', '#ffffff');
				//tdhistory.setAttribute('onclick', 'tohistory(' + sid + ')');
				//tdhistory.innerHTML = "<button href='javascript:void(0)'>>></button>";
				//tdwarnlog.setAttribute('onclick', 'towarnlog(' +sid + ')');
				//tdwarnlog.setAttribute('backgroundColor', '#ffffff');
				//tdwarnlog.style.cssText="display:none";
				//tdwarnlog.innerHTML = '<button href="javascript:void(0)">>></button>';
				tdmessage.innerHTML = msg;
				//tdmessage.style.cssText="display:none";
				tr.appendChild(tdid);
				tr.appendChild(tdename);
				tr.appendChild(tdtime);
				tr.appendChild(tdvalue);
				//tr.appendChild(tdvalue2);
				//tr.appendChild(tdhistory);
				//tr.appendChild(tdwarnlog);//z不显示不显示
				//tr.appendChild(tdtype);//不显示//不显示
				tr.appendChild(tdmessage);// 告警信息
				//var cl = "#FFFFFF";
				//tr.style.backgroundColor = cl;
				pt++;
				tbody.appendChild(tr);
				if ((alertvalue !== null) && (alertvalue !== "NaN")) {
					str_speech = str_speech +alert_sys_name+" "+sname.replace(/_/g,"杠")+" "+ alertinfo + " 数值" + alertvalue.replace(/^-/g,"负") +"  ";
					str_alert = str_alert + " " + alerttime + "  " + ": " +alert_sys_name+" "+ sname + " " + type_td+" "+ alertinfo + " 数值为:" + alertvalue+" / ";
				} else {
					str_speech =str_speech +alert_sys_name+" "+sname.replace(/_/g,"杠") +" "+ alertinfo ;
					str_alert = str_alert + " " + alerttime + "  " +": " +alert_sys_name+" "+ sname + " "+ type_td+" " + alertinfo + " " + alertvalue+" / ";// + alertvalue;
				}
			}
		}catch(err){
			showstateinfo(err.message.message,"mainpage/decoderealdata");
		}
		}
		//获取标签+系统+站名的全称。
		function getsysname(anodes,aid){
			var sys_name="";
			for(var i in anodes) {
				if(anodes[i].id == aid){
					sys_name=anodes[i].text;
					var pid=anodes[i].ParentId
					if(pid!=-1){
						sys_name=getsysname(nodes,pid)+" "+sys_name;
					}
					break;
				}
				if(anodes[i].hasOwnProperty("nodes")&& anodes[i].nodes.length>0){
					sys_name=getsysname(anodes[i].nodes,aid);
				}
			}
			return sys_name;
		}
		/*function refreshData(){
		}
		function updatanodetree() {
			if (typeof(allsensors) != "undefined" && allsensors != null) {
				for (var i = 0; i < allsensors.length; i++) {
					if (allsensors[i] != null) {
						var s_nodeid = allsensors[i].NodeId;
						updatainfotree(nodes, s_nodeid, allsensors[i]);
					}
				}
				inittreeview(nodes);
			}
		}*/
		function inittreeview_level2(anodes) {
			var tree1=$("#tree_chi");
			if(!anodes){
				var treeseneors=JSON.parse(localStorage.getItem("sensor_tree"))
				anodes=buildnode_level2(treeseneors,0);
			}
			var sensorarray;
			tree1.treeview({
				data: anodes,    // 数据源
				showCheckbox: false,   //是否显示复选框
				highlightSelected: true,    //是否高亮选中
				nodeIcon: 'glyphicon glyphicon-user',    //节点上的图标 glyphicon-stats
				//nodeIcon: 'glyphicon glyphicon-lock',//
				emptyIcon: '',    //没有子节点的节点图标
				enableLinks: false,//为true时，必须在节点属性给出href属性，否则可能发生不可预知的现象 
				multiSelect: multiselect,    //是否可以多选，采用变量控制，在切换页面时设置。
				searchResultColor: "black",
				color: "#fff",//所有节点使用的默认前景色，这个颜色会被节点数据上的Color属性覆盖.        String
				backColor: "#0d7778",//"rgba(0, 151, 105, 1);", //所有节点使用的默认背景色，这个颜色会被节点数据上的backColor属性覆盖.     String
				showBorder: false, //所有节点使用的默认背景色，这个颜色会被节点数据上的backColor属性覆盖.     String
				onhoverColor: "#3075a5", //光标停在节点上激活的默认背景色      String
				onNodeSelected: function (event, data) {//目录树节点选中事件--提取对应id，获取旗下标签
					//var selectnode=$("#tree_chi").treeview('getSelected');
					//$("#tree_chi").treeview('collapseAll')//,nodeid);//关闭展开 
					//for (var i = 0; i < data.level; i++) {//逐级展开所选节点的父节点。
					//	var p_node = getThe_level_nodeid(data, i);
					//	tree1.treeview('expandNode', [p_node.nodeId, { levels: 1, silent: true }]);
					//}
					tree1.treeview("revealNode",[currentNode, { levels: 2, silent: true }]);
                    //tree1.treeview('expandNode', [data.nodeId, { levels: 1, silent: true }]);/**/
					//setSelectOption("jcdd", data.id);
                    sessionStorage.jfjk_nodeid=data.nodeId;
					sessionStorage.SensorId=data.id;
					if(!multiselect)//多选时，标签id不被保存；用于恢复所选项
						sessionStorage.sel_id=data.id;
					if (sessionStorage.pageindex==2){
						iframemain[0].contentWindow.localrowbysensorid(data.id);//实时数据页面的点击标签树形菜单进行实时数据列表定位
					}else{
						iframemain[0].contentWindow.appenddisplaytype(data.id);//0710更新对应页面的配置项
					}
					sessionStorage.SensorName=data.text;
					sessionStorage.sensorallpathname=getSensorAllPathName(data);
					if(sessionStorage.pageindex==5){
						iframemain[0].contentWindow.document.getElementById("war_caption").innerHTML=sessionStorage.sensorallpathname;
					}
					sensorarray=tree1.treeview("getSelected");
					if(sensorarray.length>6){
						tree1.treeview("unselectNode",[data.nodeId]);
						//dialog.html("对比测量点不能大于6个!");
						//dialog.dialog("open");//,info_showtime);
						showstateinfo("对比测量点不能大于6个");
						showmsg("对比测量点不能大于6个");
						iframemain[0].contentWindow.stoptimer(iframemain[0].contentWindow.timer);//停止闪烁
						return;
						//showstateinfo("对比测量点不能大于6个");
					}else {
						showselectesensors();
					}
                    //catalog=getcatalog(dname);
                    //queryhistorydata();//0710
					//对选中的节点进行处理：依据类型（名称）不同，进行不同的处理。TODO 
					clickNode(event, data)
				},
				onNodeUnselected : function(event,data){
					clickNode(event, data);
					sensorarray=tree1.treeview("getSelected");
					showselectesensors();
				},
				onSearchComplete:function(event, data) { 
					/*if( isEmpty(data)){
						return;
					}*/
					//如果查找到的位置数据超出当前范围滚动条直接滚动到搜索结果中的第一条数据的位置
					//var tnodeId = data[0].nodeId;
					var firstSearchResult = tree1.find('ul').find('li[data-nodeid='+ sessionStorage.jfjk_nodeid +']');
					if(firstSearchResult.length>0)//避免树形菜单为空时，可能报错
						tree1.scrollTop(firstSearchResult[0].offsetTop-520);
					if(sessionStorage.pageindex==5){
						iframemain.contents().find("#war_caption").text(sessionStorage.sensorallpathname);
					}
				},
			});
			sensorarray=tree1.treeview("getSelected");
			if(anodes.length>0){
				tree1.treeview('collapseAll');//关闭展开
				//if (sessionStorage.jfjk_nodeid == "" || sessionStorage.jfjk_nodeid == null) {
					sessionStorage.jfjk_nodeid = 0;//mnodes[0].text;//如果没有选择项，则选择第一项。
				//}
				//$("#tree_chi").treeview('checkAll'  , { silent:   true   });
				var allnode=tree1.treeview("getUnselected");
				var currentNode=null;
				for(var j=0;j<allnode.length;j++){//根据所保存的标签编号（id）来确定那个标签被选中。
					if(allnode[j].id==sessionStorage.sel_id)
					{	currentNode=allnode[j]
						sessionStorage.jfjk_nodeid=allnode[j].nodeId;
						break;
					}
				}
				//var firstSearchResult = $('#tree_chi').find('ul').find('li[data-nodeid='+ sessionStorage.jfjk_nodeid +']');
					//$("#tree_chi" ).scrollTop(firstSearchResult[0].offsetTop);
				if(currentNode==null)
					currentNode = tree1.treeview("getNode", sessionStorage.jfjk_nodeid);
				
				if(!currentNode.hasOwnProperty("NodeId"))
					currentNode = tree1.treeview("getNode", 0);
				tree1.treeview("revealNode",[currentNode, { levels: 2, silent: true }]);
				//tree1.treeview('expandNode', [currentNode, { levels: 2, silent: true }]);//展开第一个节点
				//for (var i = 0; i < currentNode.level; i++) {//逐级展开所选节点的父节点。
				//	var p_node = getThe_level_nodeid(currentNode, i);
				//	tree1.treeview('expandNode', [p_node.nodeId, { levels: 1, silent: true }]);
				//}
				tree1.treeview('expandNode', [currentNode.nodeId, { levels: 1, silent: true }]);
				//$('#tree_chi').treeview('expandNode', [ tree_chi[0].id, { levels: 2, silent: true } ]);
				tree1.treeview('selectNode', [currentNode, { silent: true }]);
				sessionStorage.SensorId=currentNode.id;//获取标签id。此处即节点id（node.id)
				sessionStorage.SensorName=currentNode.text;//获取标签名称，用于列表显示用.20201110
				sessionStorage.sensorallpathname=getSensorAllPathName(currentNode);
				tree1.treeview("selectNode", currentNode);//将第一个节点设置为选中状态*/**/
				tree1.treeview("search",[sessionStorage.jfjk_nodeid+'', { ignoreCase: false, exactMatch: true }]);
				/**/
			}
			function getSensorAllPathName(anode){
				var allpathname=anode.text;
				if(anode.parentId!=null  && anode!="undefined"){
					var parentnode=tree1.treeview("getNode",anode.parentId);
					allpathname=parentnode.text+"_"+allpathname;
					if(parentnode.parentId!=null && parentnode.parentId!="undefined"){
						getSensorAllPathName(parentnode);
					}
				}
				return allpathname
			}
            function getThe_level_nodeid(anode, alevel) {
                while (anode.level > alevel) {
                    anode = (tree1.treeview("getParent", anode));
                }
                return anode;
			}/**/
			function showselectesensors(){
				if(sessionStorage.pageindex==4){
					iframemain[0].contentWindow.document.getElementById("sel-sensorname").value='所选标签:';
					for(var i=0;i<sensorarray.length;i++){
						iframemain[0].contentWindow.document.getElementById("sel-sensorname").value+=sensorarray[i].text+" , ";
					}
					iframemain[0].contentWindow.flashbutton();
				}else
				if(sessionStorage.pageindex==5||sessionStorage.pageindex==3)
					iframemain[0].contentWindow.flashbutton();
			}
		}
		function treelocationforsensorid(asensorid){//与实时数据页实时数据列表中的当前选择项同步定位于指定标签id下。
			var tree1=$("#tree_chi");
			var obj_node=tree1.treeview("getSelected");
			if(obj_node.length>0)//判断有没有选中项
			{tree1.treeview("unselectNode",obj_node[0]);}//使选择项为不选中，为下一步选择所有未选择项准备//	$("#sel-sensorname").val("所选标签: "+tree_obj.treeview("getSelected")[0].text);
			var sensors=tree1.treeview("getUnselected");//选取未选中项
			if(sensors )
			var nodeid;
			let sensors_len=sensors.length;
			//for (var i =sel_sersor_len-1 ; i >=0; i--) {//使得最后选中的标签维最靠前面的标签，树形菜单定位到第一个被选中的标签位置；原来（正序）为最后一个
				for(var j=0;j<sensors_len;j++){
					if(sensors[j].id==asensorid){
						//if(i==0)
						nodeid=sensors[j].nodeId;
						tree1.treeview("selectNode",sensors[j].nodeId);
						var firstSearchResult = tree1.find('ul').find('li[data-nodeid='+ nodeid +']');
						if(firstSearchResult.length>0)//避免树形菜单为空时，可能报错
							tree1.scrollTop(firstSearchResult[0].offsetTop-520);
						break;
					}
				}
			//}
		}
		function buildnode_level2(data, level) {
			var tree = [];
            if (data == null || typeof(data) == "undefined") {
            }else
            for (var j = 0; j < data.length; j++) {
					var anodes = new Object();
					anodes.text = data[j].value.name;//20201021+"[Id:"+data[j].value.id+"]"
					anodes.id = data[j].value.id;
                    anodes.ParentId=data[j].value.parentId;
                    anodes.NodeId=data[j].value.nodeId;//----
                    anodes.Catalog = data[j].value.type;//Catalog;
                    anodes.Address=data[j].value.address//----
                    //anodes.Group=data[j].value.group;//----
                    anodes.Serial=data[j].value.serial;//----
                    anodes.Location=data[j].value.location;//----
					anodes.Config = data[j].value.config;
					anodes.Time = data[j].value.time;
					anodes.level = level;
					if (data[j].value.hasOwnProperty("nodeId")) {
						anodes.NodeId = data[j].value.nodeId;
					}
					var icon = 'glyphicon glyphicon-user';
					switch (data[j].value.name.toLowerCase()) {
						case "机房监控":
							icon = 'glyphicon glyphicon-inbox';//
							break;
						case "门禁":
							icon = 'glyphicon glyphicon-lock';//
							break;
						case "灯光":
							icon = 'glyphicon glyphicon-cog';
							break;
						case "红外":
							icon = 'glyphicon glyphicon-signal';
							break;
						case "动力":
							icon = 'glyphicon glyphicon-retweet';
							break;
						case "环境":
							icon = "glyphicon glyphicon-leaf";//
							break;
						case "水浸":
							icon = "glyphicon glyphicon-tint";//
					}
					if (level == 0) {
						icon = "glyphicon glyphicon-home";
					}
					anodes.icon = icon;
					//var chi_len = data[j].Children.length; 
					if (data[j].children&&data[j].children.length != 0) {
						anodes.nodes = [];
						anodes.nodes = buildnode_level2(data[j].children, level + 1)
					}
					tree.push(anodes);
				}
			var compare = function (obj1, obj2) {
				if(obj1 && obj2){
				var val1 = obj1.text;
				var val2 = obj2.text;
				if (val1 < val2) {
					return -1;
				} else if (val1 > val2) {
					return 1;
				} else {
					return 0;
				}
			}
			}
			/*for(var i=0;i<tree.length-1;i++){
				for(var j=i+1;j<tree.length;j++){
					if(tree[i].text.toLowerCase()>tree[j].text.toLowerCase()){
						var tempstr=tree[i];
						tree[i]=tree[j];
						tree[j]=tempstr;
					}	
				}
			}*/
			tree.sort(compare
			)
            return tree;
        }
		function clickNode(event, data) {
			if (lastSelectedNodeId && lastSelectTime) {
				var time = new Date().getTime();
				var t = time - lastSelectTime;
				if (lastSelectedNodeId == data.nodeId && t < 300) {//所选节点相同并且时间间隔小于300毫秒，视为双击
					//customBusiness(data);
					if(sessionStorage.pageindex==8){//视频监控页面双击打开或关闭相应的视频
						iframemain[0].contentWindow.clickStartRealPlay();
					}
				}
			}
			lastSelectedNodeId = data.nodeId;
			lastSelectTime = new Date().getTime();
		}
		//监控鼠标的移动和位置
		function mouseMove(ev) 
		{ 
			//containerdiv = document.getElementById("temp1-1");       
			//containerdiv.style.display = "none";
			Ev= ev || window.event; 
			var mousePos = mouseCoords(ev); 
			
			if(mousePos.x<=20){
				var leftlist=document.getElementById("leftmenu");
				//var mainarea=document.getElementById("mainarea");
				//var allscreen=document.getElementById("alscreen");
				leftlist.style.display="block";
				//mainarea.style.width="84%";
				//allscreen.innerHTML="全屏";
				document.getElementById("aside").className="aside";
				document.getElementById("showaside").innerHTML="<<";
			}
			if((mousePos.x>(winWidth*0.15-10))){
				var leftlist=document.getElementById("leftmenu");
				leftlist.style.display="none";
				document.getElementById("aside").className="aside-hide";
				document.getElementById("showaside").innerHTML=">>";
			}
			//alert("onmousemove",500);
			//containerdiv.style.display = "block";
		} 
		function mouseCoords(ev){ 
			//showstateinfo(ev.x+" - "+ev.y);
			if(ev.pageX || ev.pageY){ 
			return {x:ev.pageX, y:ev.pageY}; 
			} 
			return{ 
				x:ev.clientX + document.body.scrollLeft - document.body.clientLeft, 
				y:ev.clientY + document.body.scrollTop - document.body.clientTop 
			}; 
			
		} 
	function showLeftMenu(aswitch){
		var img_switch=iframemain[0].contentWindow.document.getElementById("switch01");
		if(aswitch){
			document.getElementById("leftmenu").style.display="none"; //0356202888 
			//document.onmousemove=mouseMove; //跟踪鼠标位置
			document.getElementById("aside").className="aside-hide";
			document.getElementById("showaside").innerHTML=">>";
			//document.children.onmousemove=mouseMove;
			//var iframe= document.getElementById('iframe_main');
			localStorage.showLeftMenu=true;
			if (sessionStorage.pageindex==7 && img_switch){
				img_switch.src="res/on.png";
			}
			//iframe.onload = function() {
				//iframe.contentDocument.onmousemove =mouseMove;//子frame跟踪鼠标位置变换
			//}/**/
		}else{
			document.getElementById("leftmenu").style.display="block";
			//document.onmousemove='';//mouseMove; 
			//document.children.onmousemove=mouseMove;
			document.getElementById("aside").className="aside";
			document.getElementById("showaside").innerHTML="<<";
			localStorage.showLeftMenu=false;
			if (sessionStorage.pageindex==7 && img_switch){
				img_switch.src="res/off.png";
			}
			//var iframe= document.getElementById('iframe_main');
			//iframe.onload = function() {
				//iframe.contentDocument.onmousemove =''; //mouseMove;
			//}
		}
		//iframemain.attr('src', iframemain.attr('src'));//没有此语句，页面转换更流程而且不闪烁突兀。有的话等于重新加载
	}
	function list() {
		var aside=document.getElementById("aside");
		if (aside.clientWidth <= 40) {
			showLeftMenu(false)
		} else if (aside.clientWidth > 40) {
			//console.log("side")
			//body.className = "aside-hide"
			showLeftMenu(true);
		}

        }
	function show3D(){
		//iframemain.attr('src',"realdata.html");
		//$("#message_dialog").dialog('open')
		var num="-0.5dB,-32"
		playVoices('你好，世界！1234.56 1947年12月30日 '+num.replace(/^-/,"负"));
	}
	function playVoices(str){
		var msg = new window.SpeechSynthesisUtterance();
		msg.text = str;
		msg.lang = "zh-CN";//设置语言
		msg.volume = 100;//音量
		msg.rate =localStorage.speech_rate;//说话速度
		msg.pitch =localStorage.speech_pitch;//语调，值越大越尖锐
		//window.speechSynthesis.cancel();
		var str_al_info=document.getElementById("alert_info").innerHTML;
			str_al_info=str_al_info.replace(/^\s+$/g,"");
			if (str_al_info.length > 0) {
				window.speechSynthesis.speak(msg);
			}else{
				window.speechSynthesis.cancel();
			}

	}
	</script>
</body>
</html>
<!--1 sessionStorage.nodetype 节点类型，控制页面显示响应的内容和操作，原来导航栏的更新参数为直接的数值，采用此变量后自动变成字符串型，
  其他公司模拟网址： Acrelcloud-6000安全用电管理平台体验地址：http://cloud.acrel.cn/    用户名：acrel  密码：123456
  视频监控页添加至视频监控网址的跳转按钮
  0724: 调整在节点切换时（标签数据跟新后的页面刷新机制，由重新加载改为重新初始化内容，避免页面的闪烁），
  修改同一导航按钮点在选中状态多次点按多次重新加载页面的而造成的闪烁问题 修改各个子页面的初始化流程并添加初始化函数用于在主页面调用，
  解决主页面调用子页面方法和变量总是提示失败（不存在）的问题。
  告警信息查询、趋势对比页面标签二级子菜单不显示或不更新问题、实时数据页面不能从视频预览跳回到实时数据
  0727 在视窗变化时保持页面数据不变（原来是全部复位）。
  在趋势对比页面将节点切换到机房监控将跳转到历史数据查询页面（机房监控暂时没有趋势对比项）。自动隐藏左侧菜单
  一次图不能随节点进行刷新的问题（没制项refreshifrane，颠倒get数据的顺序，在后边的get数据函数中制项refreshiframe。
  系统信息页面的更新和加载（自动刷新，页面记忆）页脚的超范围滚动条（高度设置）
  0805左侧树形菜单根据配置项（localStorage.showLeftMenu)决定是否自动隐藏（鼠标离开菜单区域隐藏，鼠标到达左侧边缘显示）
  由于节点编号超出范围造成信息总览游戏节点的图形不能正常显示的问题。
  用户信息页面在浏览器刷新时被不能记忆的问题。调整用户信息页面的布局和格式（修改密码按钮）添加头像，三种浏览器测试后台定时器计时问题，极速浏览器在非活动页时减缓。
  360 google chrome tsBrowser
  设备信息、系统设置、联系我们、app下载、操作说明等页面添加返回按钮和回退功能，统一按钮验收，解决个功能页面在返回功能后页面刷新不能被系统记忆的问题。修图4
  底部添加信息提示内容。修改代码添加信息提示语句；解决窗口尺寸变化时页面内容不能自动显示的问题。更换导出到excel按钮图标。
  index.html 背景图按比例充满视窗口功能，调整历史数据、告警信息主显示区随视窗大小自动调节的共并进行调试。学习企业文化
  ie浏览器对时间格式的不兼容问题以及对表格样式的不兼容。Android 实时数据页面有其他页面跳转到实时数据页面系统退出的问题（存在为加载项）；数组字符串排序算法函数。

  
  一侧图形为空时图形不变化的问题（新改动的函数对错误提示判断项不全面）
  添加sendpostorder函数用于HTTP的post通信功能。实时数据、用户信息修改、密码修改、获取图形列表、获取指定图形信息、获取历史数据等代码的优化。
  设备分类名称由标签配置表类检索确定；
  
  登录过程的错误提示信息区分；数据交换过程中的不同错误提示信息的区分显示；系统设置的是否隐藏左侧菜单栏图标总是off问题（config文件初始化为false）；

  设备列表、app下载、联系我们等页面点击“返回（history（-1））”按钮后再次点击对应的菜单项（页面不刷新的问题）；

  对系统名称的匹配改完全相等为包含，可以匹配更多的同义名称--1204
  统一提示框的样式，使用layer.js的自动关闭弹出框，open()，使用showmsg（）进行封装1222
  添加加载知识层并进行封装1224；在加载完第一个iframe后关闭

  sessionStorage.framepage 保存iframe_main所加载的当前页面名称；
  sessionStorage.pageindex = 4; iframe_main 所加载的页面索引值
  sessionStorage.cxsj 趋势对比查询时间
  sessionStorage.comperator_sensors 参与进行趋势对比的标签列表数组
  sessionStorage.selectText 要显示的对比项目
  sessionStorage.nodeId  所选择的节点编号；
  sessionStorage.kssj;sessionStorage.jssj; 查询的起止时间
  sessionStorage.SensorId  标签编号
  sessionStorage.timeindex  查询时段索引
  sessionStorage.eventTypeSelected 所选择的告警事件数组
  sessionStorage.warnlogname  告警类别分组对应的系统实际名称
  sessionStorage.SensorName;  标签名称
  sessionStorage.islogin  与服务器的连接标志（通信是否正常的标志）
  sessionStorage.errortime  通信错误次数
  sessionStorage.password  登录密码
  sessionStorage.token  与后台服务的认证码
  sessionStorage.map_module 显示区域的长宽比例；
  sessionStorage.contents  获取到的一次侧图形内容
  sessionStorage.dataId  当前数据的最大编号（id）
  sessionStorage.refreshtoken  刷新安全认证码的码
  sessionStorage.datatype 数据类型也就是类别分组
  sessionStorage.typename=dname; 数据类别名称
  sessionStorage.typecatalog=catalog;  //对应的分组内容

  localStorage.Configs 标签的配置信息数组
  localStorage.Config  特定标签配置
  localStorage.sensors 标签信息数组
  localStorage.historydata 上次查询的历史数据数组
  localStorage.username 用户名
  localStorage.realdata 实时数据数组
  localStorage.allConfigs 标签是所有配置项
  localStorage.backfile 登录页面背景图片文件名
  localStorage.showLeftMenu 左侧菜单是否显示
  localStorage.setItem("sensor_tree",null); 标签树
  localStorage.setItem("binaries", JSON.stringify(obj_Binaries));  一次图像列表
  localStorage.allsensors  全部标签项信息.
	
  2021
  修改标签与图形绑定值的格式以及对应关系，修改实时数据中有关告警数据的解析过程；90=1/3

  浮动窗的告警信息显示变更为两次测量时间不相同时进行浮动窗告警信息显示；在选择标签后对应实时数据的列表进行定位；
-->